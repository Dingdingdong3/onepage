<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .test-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .status.success {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .results {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .vehicle-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .vehicle-item:last-child {
            border-bottom: none;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .config-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .config-item {
            margin: 10px 0;
        }
        .config-item label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        .config-item input {
            width: 400px;
            padding: 5px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Google Sheets API í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì„¤ì • ì„¹ì…˜ -->
        <div class="config-section">
            <h3>API ì„¤ì •</h3>
            <div class="config-item">
                <label>API Key:</label>
                <input type="text" id="apiKey" value="AIzaSyC2WdvJ29WTuvjkuCBGDwwiIMmmKll59ws" />
            </div>
            <div class="config-item">
                <label>Spreadsheet ID:</label>
                <input type="text" id="spreadsheetId" value="1-r-TPHcy0TBAMmnytN510pKV3npE0b5M-hqQQIm3ddA" />
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 1: API í‚¤ ê²€ì¦ -->
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 1: API í‚¤ ë° ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì ‘ê·¼ ê²€ì¦</div>
            <button onclick="testAPIAccess()">API ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
            <div id="test1-status"></div>
            <div id="test1-results" class="results" style="display:none;"></div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 2: ì‹œíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° -->
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 2: ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì‹œíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</div>
            <button onclick="getSheetsList()">ì‹œíŠ¸ ëª©ë¡ ì¡°íšŒ</button>
            <div id="test2-status"></div>
            <div id="test2-results" class="results" style="display:none;"></div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 3: ì œì¡°ì‚¬ì™€ ëª¨ë¸ëª… ë°ì´í„° ê°€ì ¸ì˜¤ê¸° -->
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 3: ì œì¡°ì‚¬ì™€ ëª¨ë¸ëª… ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</div>
            <button onclick="getManufacturerData()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
            <div id="test3-status"></div>
            <div id="test3-results" class="results" style="display:none;"></div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ 4: íŠ¹ì • ë²”ìœ„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° -->
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 4: íŠ¹ì • ë²”ìœ„ ë°ì´í„° í…ŒìŠ¤íŠ¸</div>
            <div class="config-item">
                <label>Range (ì˜ˆ: A1:C10):</label>
                <input type="text" id="testRange" value="2025 ì„œìš¸íŠ¹ë³„ì‹œ!A1:G10" />
            </div>
            <button onclick="getSpecificRange()">ë²”ìœ„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
            <div id="test4-status"></div>
            <div id="test4-results" class="results" style="display:none;"></div>
        </div>
    </div>

    <script>
        // API ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        function getConfig() {
            return {
                apiKey: document.getElementById('apiKey').value,
                spreadsheetId: document.getElementById('spreadsheetId').value
            };
        }

        // ìƒíƒœ í‘œì‹œ í—¬í¼ í•¨ìˆ˜
        function showStatus(elementId, message, type = 'loading') {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.textContent = message;
        }

        // ê²°ê³¼ í‘œì‹œ í—¬í¼ í•¨ìˆ˜
        function showResults(elementId, content) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = content;
        }

        // í…ŒìŠ¤íŠ¸ 1: API í‚¤ ê²€ì¦
        async function testAPIAccess() {
            const config = getConfig();
            showStatus('test1-status', 'API ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ì¤‘...', 'loading');
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.spreadsheetId}?key=${config.apiKey}`;
                console.log('ìš”ì²­ URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus('test1-status', 'âœ… API ì ‘ê·¼ ì„±ê³µ!', 'success');
                    showResults('test1-results', `
                        <h4>ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì •ë³´:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `);
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                showStatus('test1-status', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                showResults('test1-results', `
                    <h4>ì˜¤ë¥˜ ìƒì„¸:</h4>
                    <p>${error.message}</p>
                    <h4>ê°€ëŠ¥í•œ ì›ì¸:</h4>
                    <ul>
                        <li>API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ</li>
                        <li>Google Sheets APIê°€ í™œì„±í™”ë˜ì§€ ì•ŠìŒ</li>
                        <li>ìŠ¤í”„ë ˆë“œì‹œíŠ¸ê°€ ê³µê°œë˜ì§€ ì•ŠìŒ</li>
                        <li>ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDê°€ ì˜ëª»ë¨</li>
                    </ul>
                `);
            }
        }

        // í…ŒìŠ¤íŠ¸ 2: ì‹œíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function getSheetsList() {
            const config = getConfig();
            showStatus('test2-status', 'ì‹œíŠ¸ ëª©ë¡ ì¡°íšŒ ì¤‘...', 'loading');
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.spreadsheetId}?key=${config.apiKey}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    const sheets = data.sheets || [];
                    showStatus('test2-status', `âœ… ${sheets.length}ê°œì˜ ì‹œíŠ¸ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!`, 'success');
                    
                    let html = '<h4>ì‹œíŠ¸ ëª©ë¡:</h4><ul>';
                    sheets.forEach(sheet => {
                        html += `<li>${sheet.properties.title} (ID: ${sheet.properties.sheetId})</li>`;
                    });
                    html += '</ul>';
                    
                    showResults('test2-results', html);
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                showStatus('test2-status', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ 3: ì œì¡°ì‚¬ì™€ ëª¨ë¸ëª… ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getManufacturerData() {
            const config = getConfig();
            showStatus('test3-status', 'ì°¨ëŸ‰ ë°ì´í„° ë¡œë“œ ì¤‘...', 'loading');
            
            try {
                // ì„œìš¸íŠ¹ë³„ì‹œ ì‹œíŠ¸ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const range = encodeURIComponent('2025 ì„œìš¸íŠ¹ë³„ì‹œ!A:G');
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.spreadsheetId}/values/${range}?key=${config.apiKey}`;
                
                console.log('ìš”ì²­ URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    const rows = data.values || [];
                    
                    if (rows.length > 0) {
                        // í—¤ë” í™•ì¸
                        const headers = rows[0];
                        console.log('í—¤ë”:', headers);
                        
                        // ë°ì´í„° íŒŒì‹± (í—¤ë” ì œì™¸)
                        const vehicles = [];
                        for (let i = 1; i < Math.min(rows.length, 20); i++) { // ìµœëŒ€ 20ê°œë§Œ í‘œì‹œ
                            const row = rows[i];
                            if (row[0] && row[2] && row[3]) { // ì œì¡°ì‚¬, ëª¨ë¸ëª…, êµ­ê³ ë³´ì¡°ê¸ˆ
                                vehicles.push({
                                    manufacturer: row[0],
                                    model: row[2],
                                    nationalSubsidy: row[3]
                                });
                            }
                        }
                        
                        showStatus('test3-status', `âœ… ${vehicles.length}ê°œì˜ ì°¨ëŸ‰ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`, 'success');
                        
                        let html = '<h4>ì°¨ëŸ‰ ë°ì´í„° (ìƒìœ„ 20ê°œ):</h4>';
                        vehicles.forEach(vehicle => {
                            html += `<div class="vehicle-item">
                                <strong>${vehicle.manufacturer}</strong> - ${vehicle.model}<br>
                                êµ­ê³ ë³´ì¡°ê¸ˆ: ${vehicle.nationalSubsidy}ë§Œì›
                            </div>`;
                        });
                        
                        showResults('test3-results', html);
                    } else {
                        throw new Error('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                showStatus('test3-status', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                showResults('test3-results', `
                    <h4>ì˜¤ë¥˜ ìƒì„¸:</h4>
                    <p>${error.message}</p>
                    <p>ì‹œíŠ¸ ì´ë¦„ì´ë‚˜ ë²”ìœ„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                `);
            }
        }

        // í…ŒìŠ¤íŠ¸ 4: íŠ¹ì • ë²”ìœ„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getSpecificRange() {
            const config = getConfig();
            const range = document.getElementById('testRange').value;
            showStatus('test4-status', `'${range}' ë²”ìœ„ ë°ì´í„° ë¡œë“œ ì¤‘...`, 'loading');
            
            try {
                const encodedRange = encodeURIComponent(range);
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.spreadsheetId}/values/${encodedRange}?key=${config.apiKey}`;
                
                console.log('ìš”ì²­ URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    const rows = data.values || [];
                    showStatus('test4-status', `âœ… ${rows.length}ê°œì˜ í–‰ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`, 'success');
                    
                    let html = '<h4>ë°ì´í„°:</h4><pre>';
                    html += JSON.stringify(rows, null, 2);
                    html += '</pre>';
                    
                    showResults('test4-results', html);
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                showStatus('test4-status', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                showResults('test4-results', `
                    <h4>ì˜¤ë¥˜ ìƒì„¸:</h4>
                    <p>${error.message}</p>
                    <h4>ì˜¬ë°”ë¥¸ ë²”ìœ„ í˜•ì‹:</h4>
                    <ul>
                        <li>ì‹œíŠ¸ì´ë¦„!A1:B10</li>
                        <li>'ì‹œíŠ¸ ì´ë¦„'!A:G (ê³µë°±ì´ ìˆëŠ” ê²½ìš° ë”°ì˜´í‘œ ì‚¬ìš©)</li>
                        <li>A1:C10 (ê¸°ë³¸ ì‹œíŠ¸)</li>
                    </ul>
                `);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ API í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.onload = function() {
            console.log('Google Sheets API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        };
    </script>
</body>
</html>