<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ê¸°ì°¨ ìŠ¤ë§ˆíŠ¸ ê³„ì‚°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .page-wrapper {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-container {
            min-width: 0;
        }

        .container {
            max-width: 900px;
            margin: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .header {
            background: #1e293b;
            color: white;
            padding: 32px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .sidebar-calculator {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: fit-content;
            position: sticky;
            top: 80px;
            margin-top: 60px;
        }

        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quick-calculator {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .quick-calc-header {
            background: #1e293b;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .quick-calc-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quick-calc-body {
            padding: 20px;
        }

        .quick-input-group {
            margin-bottom: 16px;
        }

        .quick-input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 6px;
        }

        .quick-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .quick-calc-btn {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .quick-calc-btn:hover {
            background: #2563eb;
        }

        .quick-results {
            display: none;
        }

        .quick-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
        }

        .quick-result-item:last-child {
            border-bottom: none;
        }

        .quick-result-label {
            color: #64748b;
            font-weight: 500;
        }

        .quick-result-value {
            font-weight: 600;
            color: #1e293b;
        }

        .quick-result-value.positive {
            color: #059669;
        }

        .quick-final-result {
            background: #1e293b;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
        }

        .quick-final-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .quick-final-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .vehicle-selection {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .vehicle-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .vehicle-tab {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .vehicle-tab.active {
            background: white;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
        }

        .vehicle-tab-content {
            padding: 16px;
            background: white;
        }

        .vehicle-tab-panel {
            display: none;
        }

        .vehicle-tab-panel.active {
            display: block;
        }

        .vehicle-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .vehicle-item {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vehicle-item:hover {
            background: #f8fafc;
        }

        .vehicle-item:last-child {
            border-bottom: none;
        }

        .vehicle-item.selected {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }

        .vehicle-item.no-selection {
            background: #f1f5f9;
            border-left: 4px solid #64748b;
            font-weight: 500;
        }

        .vehicle-item.no-selection:hover {
            background: #e2e8f0;
        }

        .vehicle-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.95rem;
            line-height: 1.4;
            flex: 1;
        }

        .vehicle-subsidy {
            font-size: 0.85rem;
            font-weight: 500;
            min-width: 120px;
            text-align: right;
        }

        .subsidy-high {
            color: #059669;
        }

        .subsidy-medium {
            color: #d97706;
        }

        .subsidy-low {
            color: #dc2626;
        }

        .subsidy-none {
            color: #64748b;
        }

        .manufacturer-selection {
            margin-bottom: 16px;
        }

        .price-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-input {
            flex: 1;
            text-align: right;
        }

        .price-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .price-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .price-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calculate-btn:hover {
            background: #2563eb;
        }

        .result-section {
            background: #ffffff;
            padding: 40px;
            border-radius: 16px;
            margin-top: 32px;
            display: none;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .result-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .result-item {
            background: #f8fafc;
            padding: 24px 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .result-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }

        .result-item.subsidy {
            background: linear-gradient(135deg, #f0fdf4 0%, #f7fee7 100%);
            border-color: #bbf7d0;
        }

        .result-item.tax {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #fecaca;
        }

        .result-item.reduction {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #d8b4fe;
        }

        .result-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .result-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            line-height: 1.2;
        }

        .result-value.positive {
            color: #059669;
        }

        .result-value.negative {
            color: #dc2626;
        }

        .result-icon {
            font-size: 1.2rem;
        }

        .payment-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: stretch;
        }

        .calculation-breakdown {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: 100%;
            min-height: 200px;
        }

        .calculation-breakdown h4 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 0.95rem;
        }

        .breakdown-label {
            color: #475569;
            font-weight: 500;
        }

        .breakdown-value {
            color: #1e293b;
            font-weight: 600;
        }

        .breakdown-add .breakdown-label {
            color: #dc2626;
        }

        .breakdown-subtract .breakdown-label {
            color: #059669;
        }

        .breakdown-divider {
            height: 1px;
            background: #e2e8f0;
            margin: 12px 0;
        }

        .breakdown-result {
            border-top: 2px solid #3b82f6;
            padding-top: 12px !important;
            margin-top: 8px;
        }

        .breakdown-result .breakdown-label {
            color: #1e293b;
            font-weight: 700;
            font-size: 1rem;
        }

        .breakdown-result .breakdown-value {
            color: #3b82f6;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .final-result {
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            color: white;
            padding: 32px 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(30, 41, 59, 0.2);
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .final-label {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 500;
            line-height: 1.3;
            text-align: center;
            width: 100%;
        }

        .final-value {
            font-size: 2.4rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            line-height: 1.1;
            text-align: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .final-value span {
            font-size: 2.0rem;
        }

        .info-box-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
        }

        .info-box h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 0.925rem;
        }

        .info-box ul {
            margin-left: 16px;
            color: #0c4a6e;
            font-size: 0.875rem;
        }

        .info-box ul li {
            margin-bottom: 4px;
        }

        .status-indicator {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 0.875rem;
        }

        .status-indicator.working {
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        .status-indicator.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #dc2626;
        }

        .vehicle-count {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 8px;
            text-align: right;
        }

        .footer-info {
            background: #f1f5f9;
            padding: 24px;
            margin-top: 32px;
            border-radius: 8px;
            border-top: 3px solid #3b82f6;
        }

        .footer-info h4 {
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .footer-info p {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }

        .footer-info a {
            color: #3b82f6;
            text-decoration: none;
        }

        .footer-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .page-wrapper {
                display: block;
                padding: 10px;
            }
            
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .main-content {
                padding: 24px;
            }

            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .price-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .result-item {
                min-height: 100px;
                padding: 20px 16px;
            }

            .result-value {
                font-size: 1.3rem;
            }

            .payment-summary {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .vehicle-tabs {
                flex-direction: column;
            }

            .info-box-container {
                grid-template-columns: 1fr;
            }

            .vehicle-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .vehicle-subsidy {
                text-align: left;
                min-width: auto;
            }

            .final-result {
                min-height: 180px;
                padding: 24px 20px;
            }

            .final-label {
                font-size: 1.0rem;
                margin-bottom: 16px;
            }

            .final-value {
                font-size: 2.0rem;
                flex-direction: column;
                gap: 8px;
            }

            .final-value span {
                font-size: 1.6rem;
            }

            .breakdown-item {
                font-size: 0.875rem;
            }
        }

        @media (max-width: 1200px) {
            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="main-container">
            <div class="container">
                <div class="header">
                    <h1>ğŸš— ì „ê¸°ì°¨ ìŠ¤ë§ˆíŠ¸ ê³„ì‚°ê¸°</h1>
                    <p>ì „ê¸°ì°¨ êµ¬ë§¤ ì‹œ ì·¨ë“ì„¸ì™€ ë³´ì¡°ê¸ˆì„ ê°„í¸í•˜ê²Œ ê³„ì‚°í•˜ì„¸ìš”</p>
                </div>

                <div class="main-content">
                    <!-- ë°ì´í„° ë¡œë”© ìƒíƒœ í‘œì‹œ -->
                    <div id="dataStatus" class="status-indicator">
                        ğŸ”„ ìµœì‹  ì°¨ëŸ‰ ë° ë³´ì¡°ê¸ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>

                    <!-- í•„ìˆ˜ ì •ë³´ ì…ë ¥ -->
                    <div class="section">
                        <h2 class="section-title">ğŸ“‹ í•„ìˆ˜ ì •ë³´</h2>
                        
                        <div class="form-group">
                            <label class="form-label required">ì°¨ëŸ‰ ê°€ì•¡ (ë§Œì›)</label>
                            <div class="price-input-container">
                                <input type="number" id="vehiclePrice" class="input price-input" 
                                       placeholder="ì°¨ëŸ‰ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”" min="0" step="1" oninput="syncQuickCalc()" />
                                <span>ë§Œì›</span>
                            </div>
                            <div class="price-buttons">
                                <button class="price-btn" onclick="addPrice(1000)">+ 1,000ë§Œ</button>
                                <button class="price-btn" onclick="addPrice(500)">+ 500ë§Œ</button>
                                <button class="price-btn" onclick="addPrice(100)">+ 100ë§Œ</button>
                                <button class="price-btn" onclick="addPrice(50)">+ 50ë§Œ</button>
                                <button class="price-btn" onclick="addPrice(10)">+ 10ë§Œ</button>
                                <button class="price-btn" onclick="clearPrice()">ì´ˆê¸°í™”</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">ì°¨ëŸ‰ ì¢…ë¥˜</label>
                            <select id="vehicleType" class="input" onchange="syncQuickCalc()">
                                <option value="passenger" selected>ìŠ¹ìš©ì°¨ (7%)</option>
                                <option value="van">ìŠ¹í•©ì°¨ (5%)</option>
                                <option value="truck">í™”ë¬¼ì°¨ (5%)</option>
                                <option value="commercial">ì˜ì—…ìš© ìë™ì°¨ (4%)</option>
                            </select>
                        </div>
                    </div>

                    <!-- ì„ íƒ ì •ë³´ ì…ë ¥ -->
                    <div class="section">
                        <h2 class="section-title">âš™ï¸ ì„ íƒ ì •ë³´</h2>
                        
                        <div class="form-group">
                            <label class="form-label">ì°¨ëŸ‰ ì„ íƒ (êµ­ê³  ë³´ì¡°ê¸ˆ ìë™ ì ìš©)</label>
                            <div class="vehicle-selection">
                                <div class="vehicle-tabs">
                                    <button class="vehicle-tab active" onclick="switchVehicleTab('list')">ì°¨ëŸ‰ ëª©ë¡ì—ì„œ ì„ íƒ</button>
                                    <button class="vehicle-tab" onclick="switchVehicleTab('direct')">ì§ì ‘ ì…ë ¥</button>
                                </div>
                                
                                <div class="vehicle-tab-content">
                                    <!-- ì°¨ëŸ‰ ëª©ë¡ íƒ­ -->
                                    <div id="list-tab" class="vehicle-tab-panel active">
                                        <!-- ì œì¡°ì‚¬ ì„ íƒ -->
                                        <div class="manufacturer-selection">
                                            <label class="form-label">ì œì¡°ì‚¬ ì„ íƒ</label>
                                            <select id="manufacturerFilter" class="input" onchange="filterByManufacturer()">
                                                <option value="">ì „ì²´ ì œì¡°ì‚¬</option>
                                            </select>
                                        </div>
                                        
                                        <div class="vehicle-count" id="vehicleCount">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                                        <div class="vehicle-list" id="vehicleList">
                                            <div class="vehicle-item">
                                                <div class="vehicle-name">ìµœì‹  ì°¨ëŸ‰ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ì§ì ‘ ì…ë ¥ íƒ­ -->
                                    <div id="direct-tab" class="vehicle-tab-panel">
                                        <div style="margin-top: 16px;">
                                            <label class="form-label">êµ­ê³  ë³´ì¡°ê¸ˆ ì§ì ‘ ì…ë ¥ (ë§Œì›)</label>
                                            <input type="number" id="customSubsidy" class="input" 
                                                   placeholder="ë³´ì¡°ê¸ˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 680)" min="0" step="1" />
                                            <p style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                                * ì°¨ëŸ‰ ëª©ë¡ì— ì—†ëŠ” ëª¨ë¸ì˜ ê²½ìš° ì§ì ‘ ë³´ì¡°ê¸ˆì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="selectedVehicleInfo" style="margin-top: 12px; padding: 12px; background: #f0f9ff; border-radius: 6px; display: none;">
                                <strong>ì„ íƒëœ ì°¨ëŸ‰:</strong> <span id="selectedVehicleName"></span><br>
                                <strong>êµ­ê³  ë³´ì¡°ê¸ˆ:</strong> <span id="selectedVehicleSubsidy"></span>ë§Œì›
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì§€ì—­ ì„ íƒ (ì§€ìì²´ ë³´ì¡°ê¸ˆ)</label>
                            <select id="localSubsidy" class="input" onchange="syncQuickCalc()">
                                <option value="0">ì—†ìŒ</option>
                            </select>
                        </div>

                        <div class="info-box-container">
                            <div class="info-box">
                                <h4>ğŸ’° ë³´ì¡°ê¸ˆ ì§€ì› ê¸°ì¤€</h4>
                                <ul>
                                    <li><strong>ì „ì•¡ ì§€ì›:</strong> ì°¨ëŸ‰ ê°€ì•¡ 5,300ë§Œì› ë¯¸ë§Œ</li>
                                    <li><strong>50% ì§€ì›:</strong> 5,300ë§Œì› ì´ìƒ ~ 8,500ë§Œì› ë¯¸ë§Œ</li>
                                    <li><strong>ë¯¸ì§€ì›:</strong> 8,500ë§Œì› ì´ìƒ</li>
                                </ul>
                            </div>
                            <div class="info-box">
                                <h4>ğŸ·ï¸ ì·¨ë“ì„¸ ê°ë©´ í˜œíƒ</h4>
                                <ul>
                                    <li><strong>ê²½ì°¨:</strong> 4% ì ìš© í›„ 75ë§Œì› ê°ë©´</li>
                                    <li><strong>ì¼ë°˜ ì „ê¸°ì°¨:</strong> 2026ë…„ê¹Œì§€ 140ë§Œì›, 2027ë…„ 100ë§Œì› ê°ë©´</li>
                                    <li><strong>í”ŒëŸ¬ê·¸ì¸ í•˜ì´ë¸Œë¦¬ë“œ:</strong> 40ë§Œì› ê°ë©´</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateTax()">
                        ê³„ì‚°í•˜ê¸°
                    </button>

                    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                    <div id="resultSection" class="result-section">
                        <h3 class="result-title">
                            ğŸ“Š ê³„ì‚° ê²°ê³¼
                        </h3>
                        
                        <div class="result-grid">
                            <div class="result-item subsidy">
                                <div class="result-label">êµ­ê³  ë³´ì¡°ê¸ˆ</div>
                                <div class="result-value positive" id="nationalSubsidy">
                                    <span class="result-icon">ğŸ’°</span>0ë§Œì›
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">ì§€ìì²´ ë³´ì¡°ê¸ˆ</div>
                                <div class="result-value positive" id="localSubsidyAmount">
                                    <span class="result-icon">ğŸ›ï¸</span>0ë§Œì›
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">ì´ ë³´ì¡°ê¸ˆ</div>
                                <div class="result-value positive" id="totalSubsidy">
                                    <span class="result-icon">ğŸ’</span>0ë§Œì›
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">ê¸°ë³¸ ì·¨ë“ì„¸</div>
                                <div class="result-value" id="baseTax">
                                    <span class="result-icon">ğŸ“‹</span>0ë§Œì›
                                </div>
                            </div>
                            <div class="result-item reduction">
                                <div class="result-label">ê°ë©´ í˜œíƒ</div>
                                <div class="result-value positive" id="taxReduction">
                                    <span class="result-icon">ğŸ</span>0ë§Œì›
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">ìµœì¢… ì·¨ë“ì„¸</div>
                                <div class="result-value" id="finalTaxInGrid">
                                    <span class="result-icon">ğŸ’¸</span>0ë§Œì›
                                </div>
                            </div>
                        </div>

                        <!-- ì´ ì§€ë¶ˆê¸ˆì•¡ê³¼ ê³„ì‚° ìš”ì•½ -->
                        <div class="payment-summary">
                            <div class="calculation-breakdown">
                                <h4>ğŸ’¡ ê³„ì‚° ìš”ì•½</h4>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">ì°¨ëŸ‰ ê°€ê²©</span>
                                    <span class="breakdown-value" id="vehiclePriceDisplay">0ë§Œì›</span>
                                </div>
                                <div class="breakdown-item breakdown-add">
                                    <span class="breakdown-label">+ ìµœì¢… ì·¨ë“ì„¸</span>
                                    <span class="breakdown-value" id="finalTaxDisplay">0ë§Œì›</span>
                                </div>
                                <div class="breakdown-item breakdown-subtract">
                                    <span class="breakdown-label">- ì´ ë³´ì¡°ê¸ˆ</span>
                                    <span class="breakdown-value" id="totalSubsidyDisplay">0ë§Œì›</span>
                                </div>
                                <div class="breakdown-divider"></div>
                                <div class="breakdown-item breakdown-result">
                                    <span class="breakdown-label">ì‹¤ì œ ì§€ë¶ˆ ê¸ˆì•¡</span>
                                    <span class="breakdown-value" id="totalPaymentBreakdown">0ë§Œì›</span>
                                </div>
                            </div>
                            
                            <div class="final-result">
                                <div class="final-label">ì´ ì°¨ëŸ‰ ì§€ë¶ˆ ê¸ˆì•¡</div>
                                <div class="final-value" id="totalPayment">
                                    <span>ğŸ¦</span>0ë§Œì›
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í•˜ë‹¨ ì•ˆë‚´ ì •ë³´ -->
                    <div class="footer-info">
                        <h4>ğŸ“Œ ë” ìì„¸í•œ ì •ë³´ í™•ì¸</h4>
                        <p><strong>ì •í™•í•œ ë³´ì¡°ê¸ˆ í™•ì¸:</strong> <a href="https://www.ev.or.kr/nportal/buySupprt/initBuySubsidySupprtAction.do" target="_blank">ì „ê¸°ì°¨ ëˆ„ë¦¬ì§‘</a></p>
                        <p>â€¢ êµ­ê³  ë³´ì¡°ê¸ˆ: êµ¬ë§¤ ë° ì§€ì› â†’ êµ¬ë§¤ë³´ì¡°ê¸ˆ ì§€ì› â†’ êµ­ê³  ë³´ì¡°ê¸ˆ</p>
                        <p>â€¢ ì§€ìì²´ ë³´ì¡°ê¸ˆ: êµ¬ë§¤ ë° ì§€ì› â†’ êµ¬ë§¤ë³´ì¡°ê¸ˆ ì§€ì› â†’ ì§€ìì²´ ë³´ì¡°ê¸ˆ</p>
                        <p>â€¢ êµ¬ë§¤ë³´ì¡°ê¸ˆ ì§€ê¸‰í˜„í™©: êµ¬ë§¤ ë° ì§€ì› â†’ êµ¬ë§¤ë³´ì¡°ê¸ˆ ì§€ê¸‰í˜„í™©</p>
                        <p style="margin-top: 12px; font-size: 0.8rem; color: #64748b;">
                            * ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì´ë©°, ì •í™•í•œ ì„¸ì•¡ì€ ê´€í•  ì„¸ë¬´ì„œë‚˜ ì „ë¬¸ê¸°ê´€ì— ë¬¸ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                        </p>
                        <p style="font-size: 0.8rem; color: #64748b;">
                            * ì°¨ëŸ‰ ë°ì´í„°ëŠ” 2025ë…„ 7ì›” 11ì¼ ê¸°ì¤€ì´ë©°, ìµœì‹  ì •ë³´ëŠ” ì „ê¸°ì°¨ ëˆ„ë¦¬ì§‘ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡ ì‚¬ì´ë“œë°” (ë¹ ë¥¸ ê³„ì‚°ê¸°) -->
        <div class="right-sidebar">
            <div class="sidebar-calculator">
                <div class="quick-calculator">
                    <div class="quick-calc-header">
                        <h3>ğŸš€ ë¹ ë¥¸ ê³„ì‚°</h3>
                    </div>
                    <div class="quick-calc-body">
                        <div class="quick-input-group">
                            <label>ì°¨ëŸ‰ ê°€ê²© (ë§Œì›)</label>
                            <input type="number" id="quickPrice" class="quick-input" placeholder="ê°€ê²© ì…ë ¥" min="0" step="1">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>êµ­ê³  ë³´ì¡°ê¸ˆ (ë§Œì›)</label>
                            <input type="number" id="quickSubsidy" class="quick-input" placeholder="ë³´ì¡°ê¸ˆ ì…ë ¥" min="0" step="1" value="0">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>ì§€ìì²´ ë³´ì¡°ê¸ˆ (ë§Œì›)</label>
                            <input type="number" id="quickLocal" class="quick-input" placeholder="ì§€ì—­ ë³´ì¡°ê¸ˆ" min="0" step="1" value="0">
                        </div>
                        
                        <button class="quick-calc-btn" onclick="quickCalculate()">
                            âš¡ ì¦‰ì‹œ ê³„ì‚°
                        </button>
                        
                        <div id="quickResults" class="quick-results">
                            <div class="quick-result-item">
                                <span class="quick-result-label">êµ­ê³  ë³´ì¡°ê¸ˆ</span>
                                <span class="quick-result-value positive" id="quickNationalSubsidy">0ë§Œì›</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">ì§€ìì²´ ë³´ì¡°ê¸ˆ</span>
                                <span class="quick-result-value positive" id="quickLocalSubsidy">0ë§Œì›</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">ì´ ë³´ì¡°ê¸ˆ</span>
                                <span class="quick-result-value positive" id="quickTotalSubsidy">0ë§Œì›</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">ì·¨ë“ì„¸</span>
                                <span class="quick-result-value" id="quickTax">0ë§Œì›</span>
                            </div>
                            
                            <div class="quick-final-result">
                                <div class="quick-final-label">ì´ ì§€ë¶ˆ ê¸ˆì•¡</div>
                                <div class="quick-final-value" id="quickFinalAmount">0ë§Œì›</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const SPREADSHEET_ID = '1-r-TPHcy0TBAMmnytN510pKV3npE0b5M-hqQQIm3ddA';
        const API_KEY = 'AIzaSyC07iXSP28LyFr31vUbcY44LHX6rnweTH8';
        let vehicleData = [];
        let localSubsidyData = [];
        let selectedVehicle = null;
        let currentTab = 'list';
        let filteredVehicles = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘...');
            loadDataFromSheets();
        });

        // Google Sheetsì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDataFromSheets() {
            updateDataStatus('loading');
            
            try {
                console.log('Google Sheets ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                // API í‚¤ì™€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID í™•ì¸
                console.log('API í‚¤:', API_KEY ? ' ì„¤ì •ë¨' : 'ì—†ìŒ');
                console.log('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID:', SPREADSHEET_ID);
                
                // 1. ë¨¼ì € ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
                await testSpreadsheetAccess();
                
                // 2. ì„œìš¸íŠ¹ë³„ì‹œ íƒ­ì—ì„œ ì°¨ëŸ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                await loadVehicleData();
                
                // 3. ëª¨ë“  ì§€ì—­ì˜ ë³´ì¡°ê¸ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                await loadAllRegionsData();
                
                // 4. UI ì—…ë°ì´íŠ¸
                populateManufacturerOptions();
                populateVehicleList();
                populateLocalSubsidySelect();
                
                updateDataStatus('success');
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                console.error('ì—ëŸ¬ ìƒì„¸:', {
                    message: error.message,
                    status: error.status,
                    response: error.response
                });
                updateDataStatus('error', error.message);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ë°ì´í„°ë¡œ ëŒ€ì²´
                loadFallbackData();
            }
        }

        // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        async function testSpreadsheetAccess() {
            const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
            
            console.log('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸:', testUrl);
            
            const response = await fetch(testUrl);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì ‘ê·¼ ì‹¤íŒ¨:', {
                    status: response.status,
                    statusText: response.statusText,
                    error: errorText
                });
                
                let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                
                if (response.status === 403) {
                    errorMessage += ' - API í‚¤ ê¶Œí•œ ë¬¸ì œ ë˜ëŠ” Google Sheets API ë¯¸í™œì„±í™”';
                } else if (response.status === 404) {
                    errorMessage += ' - ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ';
                } else if (response.status === 401) {
                    errorMessage += ' - API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ';
                }
                
                throw new Error(errorMessage);
            }
            
            const data = await response.json();
            console.log('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë©”íƒ€ë°ì´í„°:', data);
            return data;
        }

        // ë°ì´í„° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateDataStatus(status, message = '') {
            const statusEl = document.getElementById('dataStatus');
            
            switch (status) {
                case 'loading':
                    statusEl.innerHTML = 'ğŸ”„ ìµœì‹  ì°¨ëŸ‰ ë° ë³´ì¡°ê¸ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                    statusEl.className = 'status-indicator';
                    break;
                case 'success':
                    statusEl.innerHTML = `âœ… ìµœì‹  ë°ì´í„° ë¡œë“œ ì™„ë£Œ - ì°¨ëŸ‰ ${vehicleData.length}ê°œ, ì§€ìì²´ ${localSubsidyData.length}ê°œ`;
                    statusEl.className = 'status-indicator working';
                    break;
                case 'error':
                    statusEl.innerHTML = `âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${message} - ê¸°ë³¸ ë°ì´í„°ë¡œ ì‘ë™ ì¤‘`;
                    statusEl.className = 'status-indicator error';
                    break;
            }
        }

        // ì„œìš¸íŠ¹ë³„ì‹œ íƒ­ì—ì„œ ì°¨ëŸ‰ ë°ì´í„° ë¡œë“œ
        async function loadVehicleData() {
            const range = '2025 ì„œìš¸íŠ¹ë³„ì‹œ!A:G';
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
            
            console.log('ì°¨ëŸ‰ ë°ì´í„° ìš”ì²­:', url);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`ì°¨ëŸ‰ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: HTTP ${response.status}`);
            }
            
            const data = await response.json();
            if (!data.values || data.values.length < 2) {
                throw new Error('ì°¨ëŸ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
            
            const rows = data.values.slice(1); // í—¤ë” ì œì™¸
            vehicleData = rows
                .filter(row => row[0] && row[2] && row[3]) // ì œì¡°ì‚¬, ëª¨ë¸ëª…, êµ­ê³ ë³´ì¡°ê¸ˆì´ ìˆëŠ” í–‰ë§Œ
                .map(row => ({
                    manufacturer: row[0].trim(),
                    model: row[2].trim(),
                    nationalSubsidy: parseInt(row[3]) || 0
                }));
            
            filteredVehicles = vehicleData;
            console.log(`ì°¨ëŸ‰ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${vehicleData.length}ê°œ`);
        }

        // ëª¨ë“  ì§€ì—­ì˜ ë³´ì¡°ê¸ˆ ë°ì´í„° ë¡œë“œ
        async function loadAllRegionsData() {
            // ë¨¼ì € ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì‹œíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const sheetsUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
            const sheetsResponse = await fetch(sheetsUrl);
            
            if (!sheetsResponse.ok) {
                throw new Error(`ì‹œíŠ¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: HTTP ${sheetsResponse.status}`);
            }
            
            const sheetsData = await sheetsResponse.json();
            const sheets = sheetsData.sheets || [];
            
            // 2025ë¡œ ì‹œì‘í•˜ëŠ” ì‹œíŠ¸ë“¤ ì°¾ê¸°
            const regionSheets = sheets
                .map(sheet => sheet.properties.title)
                .filter(title => title.startsWith('2025 '))
                .map(title => title.replace('2025 ', ''));
            
            console.log(`ë°œê²¬ëœ ì§€ìì²´: ${regionSheets.length}ê°œ`);
            
            localSubsidyData = [];
            
            // ê° ì§€ì—­ë³„ë¡œ í‰ê·  ì§€ìì²´ ë³´ì¡°ê¸ˆ ê³„ì‚°
            for (const region of regionSheets) {
                try {
                    const range = `2025 ${region}!A:G`;
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    if (!data.values || data.values.length < 2) continue;
                    
                    const rows = data.values.slice(1);
                    const localSubsidies = rows
                        .filter(row => row[4]) // ì§€ìì²´ ë³´ì¡°ê¸ˆì´ ìˆëŠ” í–‰ë§Œ
                        .map(row => parseInt(row[4]) || 0)
                        .filter(amount => amount > 0);
                    
                    if (localSubsidies.length > 0) {
                        const avgSubsidy = Math.round(
                            localSubsidies.reduce((sum, amount) => sum + amount, 0) / localSubsidies.length
                        );
                        
                        localSubsidyData.push({
                            region: region,
                            subsidy: avgSubsidy
                        });
                    }
                } catch (error) {
                    console.warn(`${region} ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, error);
                }
            }
            
            console.log(`ì§€ìì²´ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${localSubsidyData.length}ê°œ`);
        }

        // ê¸°ë³¸ ë°ì´í„° ë¡œë“œ (API ì‹¤íŒ¨ ì‹œ)
        function loadFallbackData() {
            vehicleData = [
                { manufacturer: 'í˜„ëŒ€ìë™ì°¨', model: 'ì•„ì´ì˜¤ë‹‰6 ë¡±ë ˆì¸ì§€ 2WD 18ì¸ì¹˜', nationalSubsidy: 686 },
                { manufacturer: 'í˜„ëŒ€ìë™ì°¨', model: 'ì•„ì´ì˜¤ë‹‰5 2WD ë¡±ë ˆì¸ì§€ 19ì¸ì¹˜', nationalSubsidy: 659 },
                { manufacturer: 'ê¸°ì•„', model: 'EV6 ë¡±ë ˆì¸ì§€ 2WD 19ì¸ì¹˜', nationalSubsidy: 655 },
                { manufacturer: 'ê¸°ì•„', model: 'EV3 ë¡±ë ˆì¸ì§€ 2WD 17ì¸ì¹˜', nationalSubsidy: 565 },
                { manufacturer: 'í˜„ëŒ€ìë™ì°¨', model: 'ì½”ë‚˜ ì¼ë ‰íŠ¸ë¦­ 2WD ë¡±ë ˆì¸ì§€ 17ì¸ì¹˜', nationalSubsidy: 623 },
                { manufacturer: 'BMW', model: 'i4 eDrive40', nationalSubsidy: 189 },
                { manufacturer: 'í…ŒìŠ¬ë¼', model: 'Model 3 Long Range', nationalSubsidy: 202 }
            ];
            
            localSubsidyData = [
                { region: 'ì„œìš¸íŠ¹ë³„ì‹œ', subsidy: 400 },
                { region: 'ë¶€ì‚°ê´‘ì—­ì‹œ', subsidy: 300 },
                { region: 'ì¸ì²œê´‘ì—­ì‹œ', subsidy: 350 },
                { region: 'ê²½ê¸°ë„', subsidy: 300 },
                { region: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', subsidy: 600 }
            ];
            
            filteredVehicles = vehicleData;
            populateManufacturerOptions();
            populateVehicleList();
            populateLocalSubsidySelect();
        }

        // ì œì¡°ì‚¬ ì˜µì…˜ ìƒì„±
        function populateManufacturerOptions() {
            const select = document.getElementById('manufacturerFilter');
            if (!select) return;
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì œì™¸)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            const manufacturers = [...new Set(vehicleData.map(vehicle => vehicle.manufacturer))];
            manufacturers.sort();
            
            manufacturers.forEach(manufacturer => {
                const option = document.createElement('option');
                option.value = manufacturer;
                option.textContent = manufacturer;
                select.appendChild(option);
            });
        }

        // ì œì¡°ì‚¬ë³„ í•„í„°ë§
        function filterByManufacturer() {
            const selectedManufacturer = document.getElementById('manufacturerFilter').value;
            
            if (selectedManufacturer) {
                filteredVehicles = vehicleData.filter(vehicle => vehicle.manufacturer === selectedManufacturer);
            } else {
                filteredVehicles = vehicleData;
            }
            
            populateVehicleList(filteredVehicles);
            updateVehicleCount(filteredVehicles.length);
        }

        // ì°¨ëŸ‰ ëª©ë¡ ìƒì„±
        function populateVehicleList(vehicles = null) {
            const vehicleList = document.getElementById('vehicleList');
            if (!vehicleList) return;
            
            const displayVehicles = vehicles || filteredVehicles;
            vehicleList.innerHTML = '';
            
            if (displayVehicles.length === 0) {
                vehicleList.innerHTML = '<div class="vehicle-item"><div class="vehicle-name">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>';
                return;
            }
            
            // ì„ íƒ ì•ˆí•¨ ì˜µì…˜ ì¶”ê°€
            const noSelectionItem = document.createElement('div');
            noSelectionItem.className = 'vehicle-item no-selection';
            noSelectionItem.onclick = () => selectVehicleFromList(null, noSelectionItem);
            noSelectionItem.innerHTML = `
                <div class="vehicle-name">ì„ íƒ ì•ˆí•¨</div>
                <div class="vehicle-subsidy subsidy-none">êµ­ê³  ë³´ì¡°ê¸ˆ: 0ë§Œì›</div>
            `;
            vehicleList.appendChild(noSelectionItem);
            
            displayVehicles.forEach((vehicle) => {
                const vehicleItem = document.createElement('div');
                vehicleItem.className = 'vehicle-item';
                vehicleItem.onclick = () => selectVehicleFromList(vehicle, vehicleItem);
                
                // ë³´ì¡°ê¸ˆ ê¸ˆì•¡ì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
                let subsidyClass = 'subsidy-high';
                if (vehicle.nationalSubsidy < 300) {
                    subsidyClass = 'subsidy-low';
                } else if (vehicle.nationalSubsidy < 500) {
                    subsidyClass = 'subsidy-medium';
                }
                
                vehicleItem.innerHTML = `
                    <div class="vehicle-name">${vehicle.manufacturer} ${vehicle.model}</div>
                    <div class="vehicle-subsidy ${subsidyClass}">êµ­ê³  ë³´ì¡°ê¸ˆ: ${vehicle.nationalSubsidy}ë§Œì›</div>
                `;
                
                vehicleList.appendChild(vehicleItem);
            });
            
            updateVehicleCount(displayVehicles.length);
        }

        // ì°¨ëŸ‰ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateVehicleCount(count) {
            const countElement = document.getElementById('vehicleCount');
            if (countElement) {
                countElement.textContent = `ì´ ${count}ê°œ ì°¨ëŸ‰`;
            }
        }

        // ì°¨ëŸ‰ ì„ íƒ
        function selectVehicleFromList(vehicle, element) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.vehicle-item').forEach(item => item.classList.remove('selected'));
            
            // í˜„ì¬ ì„ íƒ í‘œì‹œ
            element.classList.add('selected');
            
            // ì°¨ëŸ‰ ì •ë³´ ì €ì¥
            selectedVehicle = vehicle;
            
            // ì„ íƒëœ ì°¨ëŸ‰ ì •ë³´ í‘œì‹œ
            if (vehicle) {
                showSelectedVehicleInfo(`${vehicle.manufacturer} ${vehicle.model}`, vehicle.nationalSubsidy);
                // ë¹ ë¥¸ ê³„ì‚°ê¸° ë™ê¸°í™”
                document.getElementById('quickSubsidy').value = vehicle.nationalSubsidy;
            } else {
                showSelectedVehicleInfo('ì„ íƒ ì•ˆí•¨', 0);
                document.getElementById('quickSubsidy').value = 0;
            }
            
            syncQuickCalc();
        }

        // ì§€ìì²´ ë³´ì¡°ê¸ˆ ì„ íƒ ì˜µì…˜ ìƒì„±
        function populateLocalSubsidySelect() {
            const select = document.getElementById('localSubsidy');
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì œì™¸)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            localSubsidyData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.subsidy;
                option.textContent = `${item.region} (${item.subsidy}ë§Œì›)`;
                select.appendChild(option);
            });
        }

        // ì°¨ëŸ‰ íƒ­ ì „í™˜
        function switchVehicleTab(tab) {
            currentTab = tab;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.vehicle-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchVehicleTab('${tab}')"]`).classList.add('active');
            
            // íƒ­ íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.vehicle-tab-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // ì„ íƒëœ ì°¨ëŸ‰ ì •ë³´ í‘œì‹œ
        function showSelectedVehicleInfo(name, subsidy) {
            document.getElementById('selectedVehicleName').textContent = name;
            document.getElementById('selectedVehicleSubsidy').textContent = subsidy;
            document.getElementById('selectedVehicleInfo').style.display = 'block';
        }

        // ê°€ê²© ì¡°ì‘ í•¨ìˆ˜ë“¤
        function addPrice(amount) {
            const priceInput = document.getElementById('vehiclePrice');
            const currentValue = parseInt(priceInput.value) || 0;
            priceInput.value = currentValue + amount;
            syncQuickCalc();
        }

        function clearPrice() {
            document.getElementById('vehiclePrice').value = '';
            document.getElementById('quickPrice').value = '';
        }

        // ì¢Œì¸¡ê³¼ ìš°ì¸¡ ë™ê¸°í™”
        function syncQuickCalc() {
            const vehiclePrice = document.getElementById('vehiclePrice').value;
            const localSubsidy = document.getElementById('localSubsidy').value;
            
            if (vehiclePrice) {
                document.getElementById('quickPrice').value = vehiclePrice;
            }
            
            if (localSubsidy) {
                document.getElementById('quickLocal').value = localSubsidy;
            }

            // ì„ íƒëœ ì°¨ëŸ‰ì´ ìˆìœ¼ë©´ ë³´ì¡°ê¸ˆë„ ë™ê¸°í™”
            if (selectedVehicle && selectedVehicle.nationalSubsidy) {
                document.getElementById('quickSubsidy').value = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                const customSubsidy = document.getElementById('customSubsidy').value;
                if (customSubsidy) {
                    document.getElementById('quickSubsidy').value = customSubsidy;
                }
            }
        }

        // ë¹ ë¥¸ ê³„ì‚° ê¸°ëŠ¥
        function quickCalculate() {
            const quickPrice = parseInt(document.getElementById('quickPrice').value) || 0;
            const quickSubsidy = parseInt(document.getElementById('quickSubsidy').value) || 0;
            const quickLocal = parseInt(document.getElementById('quickLocal').value) || 0;

            if (!quickPrice) return;

            // ë³´ì¡°ê¸ˆ ì§€ì› ê¸°ì¤€ ì ìš©
            let subsidyRate = 1;
            if (quickPrice >= 8500) {
                subsidyRate = 0;
            } else if (quickPrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(quickSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(quickLocal * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // ê¸°ë³¸ ì·¨ë“ì„¸ ê³„ì‚° (ìŠ¹ìš©ì°¨ 7% ê¸°ì¤€)
            const baseTax = Math.floor(quickPrice * 0.07);
            const taxReduction = Math.min(140, baseTax);
            const finalTax = Math.max(0, baseTax - taxReduction);

            // ì´ ì§€ë¶ˆ ê¸ˆì•¡
            const totalPayment = Math.max(0, quickPrice + finalTax - totalSubsidy);

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('quickNationalSubsidy').textContent = `${finalNationalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('quickLocalSubsidy').textContent = `${finalLocalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('quickTotalSubsidy').textContent = `${totalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('quickTax').textContent = `${finalTax.toLocaleString()}ë§Œì›`;
            document.getElementById('quickFinalAmount').textContent = `${totalPayment.toLocaleString()}ë§Œì›`;

            document.getElementById('quickResults').style.display = 'block';
        }

        // ë©”ì¸ ê³„ì‚° ê¸°ëŠ¥
        function calculateTax() {
            const vehiclePrice = parseInt(document.getElementById('vehiclePrice').value) || 0;
            const vehicleType = document.getElementById('vehicleType').value;
            const localSubsidyAmount = parseInt(document.getElementById('localSubsidy').value) || 0;

            if (!vehiclePrice) {
                alert('ì°¨ëŸ‰ ê°€ì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // êµ­ê³  ë³´ì¡°ê¸ˆ ê³„ì‚°
            let nationalSubsidy = 0;
            if (currentTab === 'list' && selectedVehicle) {
                nationalSubsidy = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                nationalSubsidy = parseInt(document.getElementById('customSubsidy').value) || 0;
            }

            // ì„¸ìœ¨ ì„¤ì •
            const taxRates = {
                'passenger': 0.07,
                'van': 0.05,
                'truck': 0.05,
                'commercial': 0.04
            };

            // ë³´ì¡°ê¸ˆ ì§€ì› ê¸°ì¤€ ì ìš©
            let subsidyRate = 1;
            if (vehiclePrice >= 8500) {
                subsidyRate = 0;
            } else if (vehiclePrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(nationalSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(localSubsidyAmount * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // ê¸°ë³¸ ì·¨ë“ì„¸ ê³„ì‚°
            const taxRate = taxRates[vehicleType];
            const baseTax = Math.floor(vehiclePrice * taxRate);

            // ê°ë©´ ê³„ì‚°
            const taxReduction = Math.min(140, baseTax);
            const finalTax = Math.max(0, baseTax - taxReduction);

            // ì´ ì§€ë¶ˆ ê¸ˆì•¡
            const totalPayment = Math.max(0, vehiclePrice + finalTax - totalSubsidy);

            // ê²°ê³¼ í‘œì‹œ
            displayResults({
                nationalSubsidy: finalNationalSubsidy,
                localSubsidy: finalLocalSubsidy,
                totalSubsidy: totalSubsidy,
                baseTax: baseTax,
                taxReduction: taxReduction,
                finalTax: finalTax,
                totalPayment: totalPayment,
                vehiclePrice: vehiclePrice
            });

            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(results) {
            // ê¸°ë³¸ ê²°ê³¼ í‘œì‹œ
            document.getElementById('nationalSubsidy').innerHTML = `<span class="result-icon">ğŸ’°</span>${results.nationalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('localSubsidyAmount').innerHTML = `<span class="result-icon">ğŸ›ï¸</span>${results.localSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('totalSubsidy').innerHTML = `<span class="result-icon">ğŸ’</span>${results.totalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('baseTax').innerHTML = `<span class="result-icon">ğŸ“‹</span>${results.baseTax.toLocaleString()}ë§Œì›`;
            document.getElementById('taxReduction').innerHTML = `<span class="result-icon">ğŸ</span>${results.taxReduction.toLocaleString()}ë§Œì›`;
            document.getElementById('finalTaxInGrid').innerHTML = `<span class="result-icon">ğŸ’¸</span>${results.finalTax.toLocaleString()}ë§Œì›`;
            
            // ê³„ì‚° ìš”ì•½ í‘œì‹œ
            document.getElementById('vehiclePriceDisplay').textContent = `${results.vehiclePrice.toLocaleString()}ë§Œì›`;
            document.getElementById('finalTaxDisplay').textContent = `${results.finalTax.toLocaleString()}ë§Œì›`;
            document.getElementById('totalSubsidyDisplay').textContent = `${results.totalSubsidy.toLocaleString()}ë§Œì›`;
            document.getElementById('totalPaymentBreakdown').textContent = `${results.totalPayment.toLocaleString()}ë§Œì›`;
            
            // ìµœì¢… ê²°ê³¼ í‘œì‹œ
            document.getElementById('totalPayment').innerHTML = `<span>ğŸ¦</span>${results.totalPayment.toLocaleString()}ë§Œì›`;
        }
    </script>
</body>
</html>