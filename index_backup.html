<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전기차 스마트 계산기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .page-wrapper {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-container {
            min-width: 0;
        }

        .container {
            max-width: 900px;
            margin: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .header {
            background: #1e293b;
            color: white;
            padding: 32px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .sidebar-calculator {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: fit-content;
            position: sticky;
            top: 80px;
            margin-top: 60px;
        }

        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quick-calculator {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .quick-calc-header {
            background: #1e293b;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .quick-calc-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quick-calc-body {
            padding: 20px;
        }

        .quick-input-group {
            margin-bottom: 16px;
        }

        .quick-input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 6px;
        }

        .quick-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .quick-calc-btn {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .quick-calc-btn:hover {
            background: #2563eb;
        }

        .quick-results {
            display: none;
        }

        .quick-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
        }

        .quick-result-item:last-child {
            border-bottom: none;
        }

        .quick-result-label {
            color: #64748b;
            font-weight: 500;
        }

        .quick-result-value {
            font-weight: 600;
            color: #1e293b;
        }

        .quick-result-value.positive {
            color: #059669;
        }

        .quick-final-result {
            background: #1e293b;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
        }

        .quick-final-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .quick-final-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .vehicle-selection {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .vehicle-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .vehicle-tab {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .vehicle-tab.active {
            background: white;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
        }

        .vehicle-tab-content {
            padding: 16px;
            background: white;
        }

        .vehicle-tab-panel {
            display: none;
        }

        .vehicle-tab-panel.active {
            display: block;
        }

        .vehicle-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .vehicle-item {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vehicle-item:hover {
            background: #f8fafc;
        }

        .vehicle-item:last-child {
            border-bottom: none;
        }

        .vehicle-item.selected {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }

        .vehicle-item.no-selection {
            background: #f1f5f9;
            border-left: 4px solid #64748b;
            font-weight: 500;
        }

        .vehicle-item.no-selection:hover {
            background: #e2e8f0;
        }

        .vehicle-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.95rem;
            line-height: 1.4;
            flex: 1;
        }

        .vehicle-subsidy {
            font-size: 0.85rem;
            font-weight: 500;
            min-width: 120px;
            text-align: right;
        }

        .subsidy-high {
            color: #059669;
        }

        .subsidy-medium {
            color: #d97706;
        }

        .subsidy-low {
            color: #dc2626;
        }

        .subsidy-none {
            color: #64748b;
        }

        .manufacturer-selection {
            margin-bottom: 16px;
        }

        .price-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-input {
            flex: 1;
            text-align: right;
        }

        .price-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .price-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .price-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calculate-btn:hover {
            background: #2563eb;
        }

        .result-section {
            background: #ffffff;
            padding: 40px;
            border-radius: 16px;
            margin-top: 32px;
            display: none;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .result-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .result-item {
            background: #f8fafc;
            padding: 24px 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .result-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }

        .result-item.subsidy {
            background: linear-gradient(135deg, #f0fdf4 0%, #f7fee7 100%);
            border-color: #bbf7d0;
        }

        .result-item.tax {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #fecaca;
        }

        .result-item.reduction {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #d8b4fe;
        }

        .result-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .result-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            line-height: 1.2;
        }

        .result-value.positive {
            color: #059669;
        }

        .result-value.negative {
            color: #dc2626;
        }

        .result-icon {
            font-size: 1.2rem;
        }

        .payment-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: stretch;
        }

        .calculation-breakdown {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: 100%;
            min-height: 200px;
        }

        .calculation-breakdown h4 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 0.95rem;
        }

        .breakdown-label {
            color: #475569;
            font-weight: 500;
        }

        .breakdown-value {
            color: #1e293b;
            font-weight: 600;
        }

        .breakdown-add .breakdown-label {
            color: #dc2626;
        }

        .breakdown-subtract .breakdown-label {
            color: #059669;
        }

        .breakdown-divider {
            height: 1px;
            background: #e2e8f0;
            margin: 12px 0;
        }

        .breakdown-result {
            border-top: 2px solid #3b82f6;
            padding-top: 12px !important;
            margin-top: 8px;
        }

        .breakdown-result .breakdown-label {
            color: #1e293b;
            font-weight: 700;
            font-size: 1rem;
        }

        .breakdown-result .breakdown-value {
            color: #3b82f6;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .final-result {
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            color: white;
            padding: 32px 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(30, 41, 59, 0.2);
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .final-label {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 500;
            line-height: 1.3;
            text-align: center;
            width: 100%;
        }

        .final-value {
            font-size: 2.4rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            line-height: 1.1;
            text-align: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .final-value span {
            font-size: 2.0rem;
        }

        .info-box-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
        }

        .info-box h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 0.925rem;
        }

        .info-box ul {
            margin-left: 16px;
            color: #0c4a6e;
            font-size: 0.875rem;
        }

        .info-box ul li {
            margin-bottom: 4px;
        }

        .status-indicator {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 0.875rem;
        }

        .status-indicator.working {
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        .status-indicator.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #dc2626;
        }

        .vehicle-count {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 8px;
            text-align: right;
        }

        .footer-info {
            background: #f1f5f9;
            padding: 24px;
            margin-top: 32px;
            border-radius: 8px;
            border-top: 3px solid #3b82f6;
        }

        .footer-info h4 {
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .footer-info p {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }

        .footer-info a {
            color: #3b82f6;
            text-decoration: none;
        }

        .footer-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .page-wrapper {
                display: block;
                padding: 10px;
            }
            
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .main-content {
                padding: 24px;
            }

            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .price-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .result-item {
                min-height: 100px;
                padding: 20px 16px;
            }

            .result-value {
                font-size: 1.3rem;
            }

            .payment-summary {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .vehicle-tabs {
                flex-direction: column;
            }

            .info-box-container {
                grid-template-columns: 1fr;
            }

            .vehicle-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .vehicle-subsidy {
                text-align: left;
                min-width: auto;
            }

            .final-result {
                min-height: 180px;
                padding: 24px 20px;
            }

            .final-label {
                font-size: 1.0rem;
                margin-bottom: 16px;
            }

            .final-value {
                font-size: 2.0rem;
                flex-direction: column;
                gap: 8px;
            }

            .final-value span {
                font-size: 1.6rem;
            }

            .breakdown-item {
                font-size: 0.875rem;
            }
        }

        @media (max-width: 1200px) {
            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="main-container">
            <div class="container">
                <div class="header">
                    <h1>🚗 전기차 스마트 계산기</h1>
                    <p>전기차 구매 시 취득세와 보조금을 간편하게 계산하세요</p>
                </div>

                <div class="main-content">
                    <!-- 데이터 로딩 상태 표시 -->
                    <div id="dataStatus" class="status-indicator">
                        🔄 최신 차량 및 보조금 데이터를 불러오는 중...
                    </div>

                    <!-- 필수 정보 입력 -->
                    <div class="section">
                        <h2 class="section-title">📋 필수 정보</h2>
                        
                        <div class="form-group">
                            <label class="form-label required">차량 가액 (만원)</label>
                            <div class="price-input-container">
                                <input type="number" id="vehiclePrice" class="input price-input" 
                                       placeholder="차량 가격을 입력하세요" min="0" step="1" oninput="syncQuickCalc()" />
                                <span>만원</span>
                            </div>
                            <div class="price-buttons">
                                <button class="price-btn" onclick="addPrice(1000)">+ 1,000만</button>
                                <button class="price-btn" onclick="addPrice(500)">+ 500만</button>
                                <button class="price-btn" onclick="addPrice(100)">+ 100만</button>
                                <button class="price-btn" onclick="addPrice(50)">+ 50만</button>
                                <button class="price-btn" onclick="addPrice(10)">+ 10만</button>
                                <button class="price-btn" onclick="clearPrice()">초기화</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">차량 종류</label>
                            <select id="vehicleType" class="input" onchange="syncQuickCalc()">
                                <option value="passenger" selected>승용차 (7%)</option>
                                <option value="van">승합차 (5%)</option>
                                <option value="truck">화물차 (5%)</option>
                                <option value="commercial">영업용 자동차 (4%)</option>
                            </select>
                        </div>
                    </div>

                    <!-- 선택 정보 입력 -->
                    <div class="section">
                        <h2 class="section-title">⚙️ 선택 정보</h2>
                        
                        <div class="form-group">
                            <label class="form-label">차량 선택 (국고 보조금 자동 적용)</label>
                            <div class="vehicle-selection">
                                <div class="vehicle-tabs">
                                    <button class="vehicle-tab active" onclick="switchVehicleTab('list')">차량 목록에서 선택</button>
                                    <button class="vehicle-tab" onclick="switchVehicleTab('direct')">직접 입력</button>
                                </div>
                                
                                <div class="vehicle-tab-content">
                                    <!-- 차량 목록 탭 -->
                                    <div id="list-tab" class="vehicle-tab-panel active">
                                        <!-- 제조사 선택 -->
                                        <div class="manufacturer-selection">
                                            <label class="form-label">제조사 선택</label>
                                            <select id="manufacturerFilter" class="input" onchange="filterByManufacturer()">
                                                <option value="">전체 제조사</option>
                                            </select>
                                        </div>
                                        
                                        <div class="vehicle-count" id="vehicleCount">데이터 로딩 중...</div>
                                        <div class="vehicle-list" id="vehicleList">
                                            <div class="vehicle-item">
                                                <div class="vehicle-name">최신 차량 데이터를 불러오는 중입니다...</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 직접 입력 탭 -->
                                    <div id="direct-tab" class="vehicle-tab-panel">
                                        <div style="margin-top: 16px;">
                                            <label class="form-label">국고 보조금 직접 입력 (만원)</label>
                                            <input type="number" id="customSubsidy" class="input" 
                                                   placeholder="보조금 금액을 입력하세요 (예: 680)" min="0" step="1" />
                                            <p style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                                * 차량 목록에 없는 모델의 경우 직접 보조금을 입력할 수 있습니다.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="selectedVehicleInfo" style="margin-top: 12px; padding: 12px; background: #f0f9ff; border-radius: 6px; display: none;">
                                <strong>선택된 차량:</strong> <span id="selectedVehicleName"></span><br>
                                <strong>국고 보조금:</strong> <span id="selectedVehicleSubsidy"></span>만원
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">지역 선택 (지자체 보조금)</label>
                            <select id="localSubsidy" class="input" onchange="syncQuickCalc()">
                                <option value="0">없음</option>
                            </select>
                        </div>

                        <div class="info-box-container">
                            <div class="info-box">
                                <h4>💰 보조금 지원 기준</h4>
                                <ul>
                                    <li><strong>전액 지원:</strong> 차량 가액 5,300만원 미만</li>
                                    <li><strong>50% 지원:</strong> 5,300만원 이상 ~ 8,500만원 미만</li>
                                    <li><strong>미지원:</strong> 8,500만원 이상</li>
                                </ul>
                            </div>
                            <div class="info-box">
                                <h4>🏷️ 취득세 감면 혜택</h4>
                                <ul>
                                    <li><strong>경차:</strong> 4% 적용 후 75만원 감면</li>
                                    <li><strong>일반 전기차:</strong> 2026년까지 140만원, 2027년 100만원 감면</li>
                                    <li><strong>플러그인 하이브리드:</strong> 40만원 감면</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateTax()">
                        계산하기
                    </button>

                    <!-- 결과 표시 영역 -->
                    <div id="resultSection" class="result-section">
                        <h3 class="result-title">
                            📊 계산 결과
                        </h3>
                        
                        <div class="result-grid">
                            <div class="result-item subsidy">
                                <div class="result-label">국고 보조금</div>
                                <div class="result-value positive" id="nationalSubsidy">
                                    <span class="result-icon">💰</span>0만원
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">지자체 보조금</div>
                                <div class="result-value positive" id="localSubsidyAmount">
                                    <span class="result-icon">🏛️</span>0만원
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">총 보조금</div>
                                <div class="result-value positive" id="totalSubsidy">
                                    <span class="result-icon">💎</span>0만원
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">기본 취득세</div>
                                <div class="result-value" id="baseTax">
                                    <span class="result-icon">📋</span>0만원
                                </div>
                            </div>
                            <div class="result-item reduction">
                                <div class="result-label">감면 혜택</div>
                                <div class="result-value positive" id="taxReduction">
                                    <span class="result-icon">🎁</span>0만원
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">최종 취득세</div>
                                <div class="result-value" id="finalTaxInGrid">
                                    <span class="result-icon">💸</span>0만원
                                </div>
                            </div>
                        </div>

                        <!-- 총 지불금액과 계산 요약 -->
                        <div class="payment-summary">
                            <div class="calculation-breakdown">
                                <h4>💡 계산 요약</h4>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">차량 가격</span>
                                    <span class="breakdown-value" id="vehiclePriceDisplay">0만원</span>
                                </div>
                                <div class="breakdown-item breakdown-add">
                                    <span class="breakdown-label">+ 최종 취득세</span>
                                    <span class="breakdown-value" id="finalTaxDisplay">0만원</span>
                                </div>
                                <div class="breakdown-item breakdown-subtract">
                                    <span class="breakdown-label">- 총 보조금</span>
                                    <span class="breakdown-value" id="totalSubsidyDisplay">0만원</span>
                                </div>
                                <div class="breakdown-divider"></div>
                                <div class="breakdown-item breakdown-result">
                                    <span class="breakdown-label">실제 지불 금액</span>
                                    <span class="breakdown-value" id="totalPaymentBreakdown">0만원</span>
                                </div>
                            </div>
                            
                            <div class="final-result">
                                <div class="final-label">총 차량 지불 금액</div>
                                <div class="final-value" id="totalPayment">
                                    <span>🏦</span>0만원
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 하단 안내 정보 -->
                    <div class="footer-info">
                        <h4>📌 더 자세한 정보 확인</h4>
                        <p><strong>정확한 보조금 확인:</strong> <a href="https://www.ev.or.kr/nportal/buySupprt/initBuySubsidySupprtAction.do" target="_blank">전기차 누리집</a></p>
                        <p>• 국고 보조금: 구매 및 지원 → 구매보조금 지원 → 국고 보조금</p>
                        <p>• 지자체 보조금: 구매 및 지원 → 구매보조금 지원 → 지자체 보조금</p>
                        <p>• 구매보조금 지급현황: 구매 및 지원 → 구매보조금 지급현황</p>
                        <p style="margin-top: 12px; font-size: 0.8rem; color: #64748b;">
                            * 본 계산기는 참고용이며, 정확한 세액은 관할 세무서나 전문기관에 문의하시기 바랍니다.
                        </p>
                        <p style="font-size: 0.8rem; color: #64748b;">
                            * 차량 데이터는 2025년 7월 11일 기준이며, 최신 정보는 전기차 누리집에서 확인하세요.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 우측 사이드바 (빠른 계산기) -->
        <div class="right-sidebar">
            <div class="sidebar-calculator">
                <div class="quick-calculator">
                    <div class="quick-calc-header">
                        <h3>🚀 빠른 계산</h3>
                    </div>
                    <div class="quick-calc-body">
                        <div class="quick-input-group">
                            <label>차량 가격 (만원)</label>
                            <input type="number" id="quickPrice" class="quick-input" placeholder="가격 입력" min="0" step="1">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>국고 보조금 (만원)</label>
                            <input type="number" id="quickSubsidy" class="quick-input" placeholder="보조금 입력" min="0" step="1" value="0">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>지자체 보조금 (만원)</label>
                            <input type="number" id="quickLocal" class="quick-input" placeholder="지역 보조금" min="0" step="1" value="0">
                        </div>
                        
                        <button class="quick-calc-btn" onclick="quickCalculate()">
                            ⚡ 즉시 계산
                        </button>
                        
                        <div id="quickResults" class="quick-results">
                            <div class="quick-result-item">
                                <span class="quick-result-label">국고 보조금</span>
                                <span class="quick-result-value positive" id="quickNationalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">지자체 보조금</span>
                                <span class="quick-result-value positive" id="quickLocalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">총 보조금</span>
                                <span class="quick-result-value positive" id="quickTotalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">취득세</span>
                                <span class="quick-result-value" id="quickTax">0만원</span>
                            </div>
                            
                            <div class="quick-final-result">
                                <div class="quick-final-label">총 지불 금액</div>
                                <div class="quick-final-value" id="quickFinalAmount">0만원</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        const SPREADSHEET_ID = '1-r-TPHcy0TBAMmnytN510pKV3npE0b5M-hqQQIm3ddA';
        const API_KEY = 'AIzaSyC07iXSP28LyFr31vUbcY44LHX6rnweTH8';
        let vehicleData = [];
        let localSubsidyData = [];
        let selectedVehicle = null;
        let currentTab = 'list';
        let filteredVehicles = [];

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 시작...');
            loadDataFromSheets();
        });

        // Google Sheets에서 데이터 로드
        async function loadDataFromSheets() {
            updateDataStatus('loading');
            
            try {
                console.log('Google Sheets 데이터 로드 시작...');
                
                // API 키와 스프레드시트 ID 확인
                console.log('API 키:', API_KEY ? ' 설정됨' : '없음');
                console.log('스프레드시트 ID:', SPREADSHEET_ID);
                
                // 1. 먼저 스프레드시트 접근 테스트
                await testSpreadsheetAccess();
                
                // 2. 서울특별시 탭에서 차량 데이터 가져오기
                await loadVehicleData();
                
                // 3. 모든 지역의 보조금 데이터 가져오기
                await loadAllRegionsData();
                
                // 4. UI 업데이트
                populateManufacturerOptions();
                populateVehicleList();
                populateLocalSubsidySelect();
                
                updateDataStatus('success');
                console.log('데이터 로드 완료');
                
            } catch (error) {
                console.error('데이터 로드 실패:', error);
                console.error('에러 상세:', {
                    message: error.message,
                    status: error.status,
                    response: error.response
                });
                updateDataStatus('error', error.message);
                // 에러 발생 시 기본 데이터로 대체
                loadFallbackData();
            }
        }

        // 스프레드시트 접근 테스트
        async function testSpreadsheetAccess() {
            const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
            
            console.log('스프레드시트 접근 테스트:', testUrl);
            
            const response = await fetch(testUrl);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('스프레드시트 접근 실패:', {
                    status: response.status,
                    statusText: response.statusText,
                    error: errorText
                });
                
                let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                
                if (response.status === 403) {
                    errorMessage += ' - API 키 권한 문제 또는 Google Sheets API 미활성화';
                } else if (response.status === 404) {
                    errorMessage += ' - 스프레드시트를 찾을 수 없음';
                } else if (response.status === 401) {
                    errorMessage += ' - API 키가 유효하지 않음';
                }
                
                throw new Error(errorMessage);
            }
            
            const data = await response.json();
            console.log('스프레드시트 메타데이터:', data);
            return data;
        }

        // 데이터 상태 업데이트
        function updateDataStatus(status, message = '') {
            const statusEl = document.getElementById('dataStatus');
            
            switch (status) {
                case 'loading':
                    statusEl.innerHTML = '🔄 최신 차량 및 보조금 데이터를 불러오는 중...';
                    statusEl.className = 'status-indicator';
                    break;
                case 'success':
                    statusEl.innerHTML = `✅ 최신 데이터 로드 완료 - 차량 ${vehicleData.length}개, 지자체 ${localSubsidyData.length}개`;
                    statusEl.className = 'status-indicator working';
                    break;
                case 'error':
                    statusEl.innerHTML = `❌ 데이터 로드 실패: ${message} - 기본 데이터로 작동 중`;
                    statusEl.className = 'status-indicator error';
                    break;
            }
        }

        // 서울특별시 탭에서 차량 데이터 로드
        async function loadVehicleData() {
            const range = '2025 서울특별시!A:G';
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
            
            console.log('차량 데이터 요청:', url);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`차량 데이터 로드 실패: HTTP ${response.status}`);
            }
            
            const data = await response.json();
            if (!data.values || data.values.length < 2) {
                throw new Error('차량 데이터가 없습니다');
            }
            
            const rows = data.values.slice(1); // 헤더 제외
            vehicleData = rows
                .filter(row => row[0] && row[2] && row[3]) // 제조사, 모델명, 국고보조금이 있는 행만
                .map(row => ({
                    manufacturer: row[0].trim(),
                    model: row[2].trim(),
                    nationalSubsidy: parseInt(row[3]) || 0
                }));
            
            filteredVehicles = vehicleData;
            console.log(`차량 데이터 로드 완료: ${vehicleData.length}개`);
        }

        // 모든 지역의 보조금 데이터 로드
        async function loadAllRegionsData() {
            // 먼저 스프레드시트의 시트 목록 가져오기
            const sheetsUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
            const sheetsResponse = await fetch(sheetsUrl);
            
            if (!sheetsResponse.ok) {
                throw new Error(`시트 목록 로드 실패: HTTP ${sheetsResponse.status}`);
            }
            
            const sheetsData = await sheetsResponse.json();
            const sheets = sheetsData.sheets || [];
            
            // 2025로 시작하는 시트들 찾기
            const regionSheets = sheets
                .map(sheet => sheet.properties.title)
                .filter(title => title.startsWith('2025 '))
                .map(title => title.replace('2025 ', ''));
            
            console.log(`발견된 지자체: ${regionSheets.length}개`);
            
            localSubsidyData = [];
            
            // 각 지역별로 평균 지자체 보조금 계산
            for (const region of regionSheets) {
                try {
                    const range = `2025 ${region}!A:G`;
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    if (!data.values || data.values.length < 2) continue;
                    
                    const rows = data.values.slice(1);
                    const localSubsidies = rows
                        .filter(row => row[4]) // 지자체 보조금이 있는 행만
                        .map(row => parseInt(row[4]) || 0)
                        .filter(amount => amount > 0);
                    
                    if (localSubsidies.length > 0) {
                        const avgSubsidy = Math.round(
                            localSubsidies.reduce((sum, amount) => sum + amount, 0) / localSubsidies.length
                        );
                        
                        localSubsidyData.push({
                            region: region,
                            subsidy: avgSubsidy
                        });
                    }
                } catch (error) {
                    console.warn(`${region} 데이터 로드 실패:`, error);
                }
            }
            
            console.log(`지자체 데이터 로드 완료: ${localSubsidyData.length}개`);
        }

        // 기본 데이터 로드 (API 실패 시)
        function loadFallbackData() {
            vehicleData = [
                { manufacturer: '현대자동차', model: '아이오닉6 롱레인지 2WD 18인치', nationalSubsidy: 686 },
                { manufacturer: '현대자동차', model: '아이오닉5 2WD 롱레인지 19인치', nationalSubsidy: 659 },
                { manufacturer: '기아', model: 'EV6 롱레인지 2WD 19인치', nationalSubsidy: 655 },
                { manufacturer: '기아', model: 'EV3 롱레인지 2WD 17인치', nationalSubsidy: 565 },
                { manufacturer: '현대자동차', model: '코나 일렉트릭 2WD 롱레인지 17인치', nationalSubsidy: 623 },
                { manufacturer: 'BMW', model: 'i4 eDrive40', nationalSubsidy: 189 },
                { manufacturer: '테슬라', model: 'Model 3 Long Range', nationalSubsidy: 202 }
            ];
            
            localSubsidyData = [
                { region: '서울특별시', subsidy: 400 },
                { region: '부산광역시', subsidy: 300 },
                { region: '인천광역시', subsidy: 350 },
                { region: '경기도', subsidy: 300 },
                { region: '제주특별자치도', subsidy: 600 }
            ];
            
            filteredVehicles = vehicleData;
            populateManufacturerOptions();
            populateVehicleList();
            populateLocalSubsidySelect();
        }

        // 제조사 옵션 생성
        function populateManufacturerOptions() {
            const select = document.getElementById('manufacturerFilter');
            if (!select) return;
            
            // 기존 옵션 제거 (첫 번째 제외)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            const manufacturers = [...new Set(vehicleData.map(vehicle => vehicle.manufacturer))];
            manufacturers.sort();
            
            manufacturers.forEach(manufacturer => {
                const option = document.createElement('option');
                option.value = manufacturer;
                option.textContent = manufacturer;
                select.appendChild(option);
            });
        }

        // 제조사별 필터링
        function filterByManufacturer() {
            const selectedManufacturer = document.getElementById('manufacturerFilter').value;
            
            if (selectedManufacturer) {
                filteredVehicles = vehicleData.filter(vehicle => vehicle.manufacturer === selectedManufacturer);
            } else {
                filteredVehicles = vehicleData;
            }
            
            populateVehicleList(filteredVehicles);
            updateVehicleCount(filteredVehicles.length);
        }

        // 차량 목록 생성
        function populateVehicleList(vehicles = null) {
            const vehicleList = document.getElementById('vehicleList');
            if (!vehicleList) return;
            
            const displayVehicles = vehicles || filteredVehicles;
            vehicleList.innerHTML = '';
            
            if (displayVehicles.length === 0) {
                vehicleList.innerHTML = '<div class="vehicle-item"><div class="vehicle-name">검색 결과가 없습니다.</div></div>';
                return;
            }
            
            // 선택 안함 옵션 추가
            const noSelectionItem = document.createElement('div');
            noSelectionItem.className = 'vehicle-item no-selection';
            noSelectionItem.onclick = () => selectVehicleFromList(null, noSelectionItem);
            noSelectionItem.innerHTML = `
                <div class="vehicle-name">선택 안함</div>
                <div class="vehicle-subsidy subsidy-none">국고 보조금: 0만원</div>
            `;
            vehicleList.appendChild(noSelectionItem);
            
            displayVehicles.forEach((vehicle) => {
                const vehicleItem = document.createElement('div');
                vehicleItem.className = 'vehicle-item';
                vehicleItem.onclick = () => selectVehicleFromList(vehicle, vehicleItem);
                
                // 보조금 금액에 따른 색상 클래스 결정
                let subsidyClass = 'subsidy-high';
                if (vehicle.nationalSubsidy < 300) {
                    subsidyClass = 'subsidy-low';
                } else if (vehicle.nationalSubsidy < 500) {
                    subsidyClass = 'subsidy-medium';
                }
                
                vehicleItem.innerHTML = `
                    <div class="vehicle-name">${vehicle.manufacturer} ${vehicle.model}</div>
                    <div class="vehicle-subsidy ${subsidyClass}">국고 보조금: ${vehicle.nationalSubsidy}만원</div>
                `;
                
                vehicleList.appendChild(vehicleItem);
            });
            
            updateVehicleCount(displayVehicles.length);
        }

        // 차량 개수 업데이트
        function updateVehicleCount(count) {
            const countElement = document.getElementById('vehicleCount');
            if (countElement) {
                countElement.textContent = `총 ${count}개 차량`;
            }
        }

        // 차량 선택
        function selectVehicleFromList(vehicle, element) {
            // 이전 선택 해제
            document.querySelectorAll('.vehicle-item').forEach(item => item.classList.remove('selected'));
            
            // 현재 선택 표시
            element.classList.add('selected');
            
            // 차량 정보 저장
            selectedVehicle = vehicle;
            
            // 선택된 차량 정보 표시
            if (vehicle) {
                showSelectedVehicleInfo(`${vehicle.manufacturer} ${vehicle.model}`, vehicle.nationalSubsidy);
                // 빠른 계산기 동기화
                document.getElementById('quickSubsidy').value = vehicle.nationalSubsidy;
            } else {
                showSelectedVehicleInfo('선택 안함', 0);
                document.getElementById('quickSubsidy').value = 0;
            }
            
            syncQuickCalc();
        }

        // 지자체 보조금 선택 옵션 생성
        function populateLocalSubsidySelect() {
            const select = document.getElementById('localSubsidy');
            
            // 기존 옵션 제거 (첫 번째 제외)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            localSubsidyData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.subsidy;
                option.textContent = `${item.region} (${item.subsidy}만원)`;
                select.appendChild(option);
            });
        }

        // 차량 탭 전환
        function switchVehicleTab(tab) {
            currentTab = tab;
            
            // 탭 버튼 활성화 상태 변경
            document.querySelectorAll('.vehicle-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchVehicleTab('${tab}')"]`).classList.add('active');
            
            // 탭 패널 표시/숨김
            document.querySelectorAll('.vehicle-tab-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // 선택된 차량 정보 표시
        function showSelectedVehicleInfo(name, subsidy) {
            document.getElementById('selectedVehicleName').textContent = name;
            document.getElementById('selectedVehicleSubsidy').textContent = subsidy;
            document.getElementById('selectedVehicleInfo').style.display = 'block';
        }

        // 가격 조작 함수들
        function addPrice(amount) {
            const priceInput = document.getElementById('vehiclePrice');
            const currentValue = parseInt(priceInput.value) || 0;
            priceInput.value = currentValue + amount;
            syncQuickCalc();
        }

        function clearPrice() {
            document.getElementById('vehiclePrice').value = '';
            document.getElementById('quickPrice').value = '';
        }

        // 좌측과 우측 동기화
        function syncQuickCalc() {
            const vehiclePrice = document.getElementById('vehiclePrice').value;
            const localSubsidy = document.getElementById('localSubsidy').value;
            
            if (vehiclePrice) {
                document.getElementById('quickPrice').value = vehiclePrice;
            }
            
            if (localSubsidy) {
                document.getElementById('quickLocal').value = localSubsidy;
            }

            // 선택된 차량이 있으면 보조금도 동기화
            if (selectedVehicle && selectedVehicle.nationalSubsidy) {
                document.getElementById('quickSubsidy').value = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                const customSubsidy = document.getElementById('customSubsidy').value;
                if (customSubsidy) {
                    document.getElementById('quickSubsidy').value = customSubsidy;
                }
            }
        }

        // 빠른 계산 기능
        function quickCalculate() {
            const quickPrice = parseInt(document.getElementById('quickPrice').value) || 0;
            const quickSubsidy = parseInt(document.getElementById('quickSubsidy').value) || 0;
            const quickLocal = parseInt(document.getElementById('quickLocal').value) || 0;

            if (!quickPrice) return;

            // 보조금 지원 기준 적용
            let subsidyRate = 1;
            if (quickPrice >= 8500) {
                subsidyRate = 0;
            } else if (quickPrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(quickSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(quickLocal * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // 기본 취득세 계산 (승용차 7% 기준)
            const baseTax = Math.floor(quickPrice * 0.07);
            const taxReduction = Math.min(140, baseTax);
            const finalTax = Math.max(0, baseTax - taxReduction);

            // 총 지불 금액
            const totalPayment = Math.max(0, quickPrice + finalTax - totalSubsidy);

            // 결과 표시
            document.getElementById('quickNationalSubsidy').textContent = `${finalNationalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickLocalSubsidy').textContent = `${finalLocalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickTotalSubsidy').textContent = `${totalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickTax').textContent = `${finalTax.toLocaleString()}만원`;
            document.getElementById('quickFinalAmount').textContent = `${totalPayment.toLocaleString()}만원`;

            document.getElementById('quickResults').style.display = 'block';
        }

        // 메인 계산 기능
        function calculateTax() {
            const vehiclePrice = parseInt(document.getElementById('vehiclePrice').value) || 0;
            const vehicleType = document.getElementById('vehicleType').value;
            const localSubsidyAmount = parseInt(document.getElementById('localSubsidy').value) || 0;

            if (!vehiclePrice) {
                alert('차량 가액을 입력해주세요.');
                return;
            }

            // 국고 보조금 계산
            let nationalSubsidy = 0;
            if (currentTab === 'list' && selectedVehicle) {
                nationalSubsidy = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                nationalSubsidy = parseInt(document.getElementById('customSubsidy').value) || 0;
            }

            // 세율 설정
            const taxRates = {
                'passenger': 0.07,
                'van': 0.05,
                'truck': 0.05,
                'commercial': 0.04
            };

            // 보조금 지원 기준 적용
            let subsidyRate = 1;
            if (vehiclePrice >= 8500) {
                subsidyRate = 0;
            } else if (vehiclePrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(nationalSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(localSubsidyAmount * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // 기본 취득세 계산
            const taxRate = taxRates[vehicleType];
            const baseTax = Math.floor(vehiclePrice * taxRate);

            // 감면 계산
            const taxReduction = Math.min(140, baseTax);
            const finalTax = Math.max(0, baseTax - taxReduction);

            // 총 지불 금액
            const totalPayment = Math.max(0, vehiclePrice + finalTax - totalSubsidy);

            // 결과 표시
            displayResults({
                nationalSubsidy: finalNationalSubsidy,
                localSubsidy: finalLocalSubsidy,
                totalSubsidy: totalSubsidy,
                baseTax: baseTax,
                taxReduction: taxReduction,
                finalTax: finalTax,
                totalPayment: totalPayment,
                vehiclePrice: vehiclePrice
            });

            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // 결과 표시
        function displayResults(results) {
            // 기본 결과 표시
            document.getElementById('nationalSubsidy').innerHTML = `<span class="result-icon">💰</span>${results.nationalSubsidy.toLocaleString()}만원`;
            document.getElementById('localSubsidyAmount').innerHTML = `<span class="result-icon">🏛️</span>${results.localSubsidy.toLocaleString()}만원`;
            document.getElementById('totalSubsidy').innerHTML = `<span class="result-icon">💎</span>${results.totalSubsidy.toLocaleString()}만원`;
            document.getElementById('baseTax').innerHTML = `<span class="result-icon">📋</span>${results.baseTax.toLocaleString()}만원`;
            document.getElementById('taxReduction').innerHTML = `<span class="result-icon">🎁</span>${results.taxReduction.toLocaleString()}만원`;
            document.getElementById('finalTaxInGrid').innerHTML = `<span class="result-icon">💸</span>${results.finalTax.toLocaleString()}만원`;
            
            // 계산 요약 표시
            document.getElementById('vehiclePriceDisplay').textContent = `${results.vehiclePrice.toLocaleString()}만원`;
            document.getElementById('finalTaxDisplay').textContent = `${results.finalTax.toLocaleString()}만원`;
            document.getElementById('totalSubsidyDisplay').textContent = `${results.totalSubsidy.toLocaleString()}만원`;
            document.getElementById('totalPaymentBreakdown').textContent = `${results.totalPayment.toLocaleString()}만원`;
            
            // 최종 결과 표시
            document.getElementById('totalPayment').innerHTML = `<span>🏦</span>${results.totalPayment.toLocaleString()}만원`;
        }
    </script>
</body>
</html>