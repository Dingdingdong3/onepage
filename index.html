<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전기차 스마트 계산기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .header {
            background: #1e293b;
            color: white;
            padding: 32px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 차량 선택 관련 스타일 */
        .vehicle-selection {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .vehicle-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .vehicle-tab {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .vehicle-tab.active {
            background: white;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
        }

        .vehicle-tab-content {
            padding: 16px;
            background: white;
        }

        .vehicle-tab-panel {
            display: none;
        }

        .vehicle-tab-panel.active {
            display: block;
        }

        .vehicle-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .vehicle-item {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vehicle-item:hover {
            background: #f8fafc;
        }

        .vehicle-item:last-child {
            border-bottom: none;
        }

        .vehicle-item.selected {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }

        .vehicle-item.no-selection {
            background: #f1f5f9;
            border-left: 4px solid #64748b;
            font-weight: 500;
        }

        .vehicle-item.no-selection:hover {
            background: #e2e8f0;
        }

        .vehicle-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.95rem;
            line-height: 1.4;
            flex: 1;
        }

        .vehicle-subsidy {
            font-size: 0.85rem;
            font-weight: 500;
            min-width: 120px;
            text-align: right;
        }

        .subsidy-high {
            color: #059669;
        }

        .subsidy-medium {
            color: #d97706;
        }

        .subsidy-low {
            color: #dc2626;
        }

        .subsidy-none {
            color: #64748b;
        }

        /* 가격 입력 버튼 */
        .price-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-input {
            flex: 1;
            text-align: right;
        }

        .price-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .price-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .price-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calculate-btn:hover {
            background: #2563eb;
        }

        .calculate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        /* 결과 섹션 */
        .result-section {
            background: #ffffff;
            padding: 40px;
            border-radius: 16px;
            margin-top: 32px;
            display: none;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .result-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .result-item {
            background: #f8fafc;
            padding: 28px 24px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .result-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .result-item.subsidy {
            background: linear-gradient(135deg, #f0fdf4 0%, #f7fee7 100%);
            border-color: #bbf7d0;
        }

        .result-item.tax {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #fecaca;
        }

        .result-item.reduction {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #d8b4fe;
        }

        .result-label {
            font-size: 0.95rem;
            color: #64748b;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .result-value.positive {
            color: #059669;
        }

        .result-value.negative {
            color: #dc2626;
        }

        .result-icon {
            font-size: 1.25rem;
        }

        .final-result {
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            color: white;
            padding: 36px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(30, 41, 59, 0.2);
        }

        .final-label {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .final-value {
            font-size: 2.5rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        /* 정보 박스 */
        .info-box-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
        }

        .info-box h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 0.925rem;
        }

        .info-box ul {
            margin-left: 16px;
            color: #0c4a6e;
            font-size: 0.875rem;
        }

        .info-box ul li {
            margin-bottom: 4px;
        }

        /* 하단 안내 */
        .footer-info {
            background: #f1f5f9;
            padding: 24px;
            margin-top: 32px;
            border-radius: 8px;
            border-top: 3px solid #3b82f6;
        }

        .footer-info h4 {
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .footer-info p {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }

        .footer-info a {
            color: #3b82f6;
            text-decoration: none;
        }

        .footer-info a:hover {
            text-decoration: underline;
        }

        /* 에러 메시지 */
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 0.875rem;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .main-content {
                padding: 24px;
            }

            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .price-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-grid {
                grid-template-columns: 1fr;
            }

            .vehicle-tabs {
                flex-direction: column;
            }

            .info-box-container {
                grid-template-columns: 1fr;
            }

            .vehicle-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .vehicle-subsidy {
                text-align: left;
                min-width: auto;
            }
        }

        .custom-input-section {
            margin-top: 16px;
        }

        .custom-input-row {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 12px;
            align-items: end;
        }

        .select-vehicle-btn {
            padding: 8px 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .select-vehicle-btn:hover {
            background: #2563eb;
        }

        .flex-1 {
            flex: 1;
        }

        /* 광고 컨테이너 */
        .ad-container {
            margin: 32px 0;
            text-align: center;
        }

        .ad-placeholder {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 40px 20px;
            color: #64748b;
            font-size: 0.875rem;
        }

        .ad-placeholder p {
            margin: 0 0 4px 0;
            font-weight: 500;
        }

        .ad-placeholder span {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        /* 하단 푸터 */
        .footer {
            background: #1e293b;
            color: white;
            margin-top: 0;
        }

        .footer-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px 40px;
            text-align: center;
        }

        .footer-content p {
            margin: 0 0 8px 0;
            opacity: 0.9;
        }

        .footer-content p:first-child {
            font-weight: 500;
            font-size: 1rem;
        }

        .footer-content p:last-of-type {
            font-size: 0.875rem;
            opacity: 0.7;
            margin-bottom: 16px;
        }

        .footer-links {
            font-size: 0.875rem;
        }

        .footer-links a {
            color: #94a3b8;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-links span {
            margin: 0 12px;
            opacity: 0.5;
        }

        /* 검색 자동완성 개선 */
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #3b82f6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .suggestions-custom {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #3b82f6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 180px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover {
            background-color: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-highlight {
            background-color: #fef3c7;
            font-weight: 500;
        }

        .search-container {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚗 전기차 스마트 계산기</h1>
            <p>전기차 구매 시 취득세와 보조금을 간편하게 계산하세요</p>
        </div>

        <div class="main-content">
            <!-- 필수 정보 입력 -->
            <div class="section">
                <h2 class="section-title">📋 필수 정보</h2>
                
                <div class="form-group">
                    <label class="form-label required">차량 가액 (만원)</label>
                    <div class="price-input-container">
                        <input type="number" id="vehiclePrice" class="input price-input" 
                               placeholder="차량 가격을 입력하세요" min="0" step="1" />
                        <span>만원</span>
                    </div>
                    <div class="price-buttons">
                        <button class="price-btn" onclick="addPrice(1000)">+ 1,000만</button>
                        <button class="price-btn" onclick="addPrice(500)">+ 500만</button>
                        <button class="price-btn" onclick="addPrice(100)">+ 100만</button>
                        <button class="price-btn" onclick="addPrice(50)">+ 50만</button>
                        <button class="price-btn" onclick="addPrice(10)">+ 10만</button>
                        <button class="price-btn" onclick="clearPrice()">초기화</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">차량 종류</label>
                    <select id="vehicleType" class="input">
                        <option value="">차량 종류를 선택하세요</option>
                        <option value="passenger">승용차 (7%)</option>
                        <option value="van">승합차 (5%)</option>
                        <option value="truck">화물차 (5%)</option>
                        <option value="commercial">영업용 자동차 (4%)</option>
                    </select>
                </div>
            </div>

            <!-- 선택 정보 입력 -->
            <div class="section">
                <h2 class="section-title">⚙️ 선택 정보</h2>
                
                <div class="form-group">
                    <label class="form-label">차량 선택 (국고 보조금 자동 적용)</label>
                    <div class="vehicle-selection">
                        <div class="vehicle-tabs">
                            <button class="vehicle-tab active" onclick="switchVehicleTab('list')">차량 목록에서 선택</button>
                            <button class="vehicle-tab" onclick="switchVehicleTab('direct')">직접 입력</button>
                        </div>
                        
                        <div class="vehicle-tab-content">
                            <!-- 차량 목록 탭 -->
                            <div id="list-tab" class="vehicle-tab-panel active">
                                <div class="vehicle-list" id="vehicleList">
                                    <!-- 차량 목록이 여기에 동적으로 생성됩니다 -->
                                </div>
                            </div>
                            
                            <!-- 직접 입력 탭 -->
                            <div id="direct-tab" class="vehicle-tab-panel">
                                <div class="custom-input-section">
                                    <div class="search-container">
                                        <input type="text" id="customVehicleName" class="input" 
                                               placeholder="차량 모델명을 입력하세요 (예: 아이오닉6 롱레인지)" />
                                        <div id="customVehicleSuggestions" class="suggestions-custom"></div>
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                                        <button class="select-vehicle-btn flex-1" onclick="selectCustomVehicle()">직접 입력으로 선택</button>
                                        <button class="select-vehicle-btn" onclick="clearCustomSelection()">초기화</button>
                                    </div>
                                    
                                    <div style="margin-top: 16px;">
                                        <label class="form-label">국고 보조금 직접 입력 (만원)</label>
                                        <input type="number" id="customSubsidy" class="input" 
                                               placeholder="보조금 금액을 입력하세요 (예: 680)" min="0" step="1" />
                                    </div>
                                    
                                    <p style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                        * 차량명 입력 후 자동완성에서 선택하거나, 보조금을 직접 입력할 수 있습니다.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="selectedVehicleInfo" style="margin-top: 12px; padding: 12px; background: #f0f9ff; border-radius: 6px; display: none;">
                        <strong>선택된 차량:</strong> <span id="selectedVehicleName"></span><br>
                        <strong>국고 보조금:</strong> <span id="selectedVehicleSubsidy"></span>만원
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">지역 선택 (지자체 보조금)</label>
                    <select id="localSubsidy" class="input">
                        <option value="0">없음</option>
                    </select>
                </div>

                <div class="info-box-container">
                    <div class="info-box">
                        <h4>💰 보조금 지원 기준</h4>
                        <ul>
                            <li><strong>전액 지원:</strong> 차량 가액 5,300만원 미만</li>
                            <li><strong>50% 지원:</strong> 5,300만원 이상 ~ 8,500만원 미만</li>
                            <li><strong>미지원:</strong> 8,500만원 이상</li>
                        </ul>
                    </div>
                    <div class="info-box">
                        <h4>🏷️ 취득세 감면 혜택</h4>
                        <ul>
                            <li><strong>경차:</strong> 4% 적용 후 75만원 감면</li>
                            <li><strong>일반 전기차:</strong> 2026년까지 140만원, 2027년 100만원 감면</li>
                            <li><strong>플러그인 하이브리드:</strong> 40만원 감면</li>
                        </ul>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateTax()">
                계산하기
            </button>

            <!-- 결과 표시 영역 -->
            <div id="resultSection" class="result-section">
                <h3 class="result-title">
                    📊 계산 결과
                </h3>
                
                <div class="result-grid">
                    <div class="result-item subsidy">
                        <div class="result-label">국고 보조금</div>
                        <div class="result-value positive" id="nationalSubsidy">
                            <span class="result-icon">💰</span>0만원
                        </div>
                    </div>
                    <div class="result-item subsidy">
                        <div class="result-label">지자체 보조금</div>
                        <div class="result-value positive" id="localSubsidyAmount">
                            <span class="result-icon">🏛️</span>0만원
                        </div>
                    </div>
                    <div class="result-item subsidy">
                        <div class="result-label">총 보조금</div>
                        <div class="result-value positive" id="totalSubsidy">
                            <span class="result-icon">💎</span>0만원
                        </div>
                    </div>
                    <div class="result-item tax">
                        <div class="result-label">기본 취득세</div>
                        <div class="result-value" id="baseTax">
                            <span class="result-icon">📋</span>0만원
                        </div>
                    </div>
                    <div class="result-item reduction">
                        <div class="result-label">감면 혜택</div>
                        <div class="result-value positive" id="taxReduction">
                            <span class="result-icon">🎁</span>0만원
                        </div>
                    </div>
                </div>

                <div class="final-result">
                    <div class="final-label">최종 부담 취득세</div>
                    <div class="final-value" id="finalTax">
                        <span>💸</span>0만원
                    </div>
                </div>
            </div>

            <!-- 하단 안내 정보 -->
            <div class="footer-info">
                <h4>📌 더 자세한 정보 확인</h4>
                <p><strong>정확한 보조금 확인:</strong> <a href="https://www.ev.or.kr/nportal/buySupprt/initBuySubsidySupprtAction.do" target="_blank">전기차 누리집</a></p>
                <p>• 국고 보조금: 구매 및 지원 → 구매보조금 지원 → 국고 보조금</p>
                <p>• 지자체 보조금: 구매 및 지원 → 구매보조금 지원 → 지자체 보조금</p>
                <p>• 구매보조금 지급현황: 구매 및 지원 → 구매보조금 지급현황</p>
                <p style="margin-top: 12px; font-size: 0.8rem; color: #64748b;">
                    * 본 계산기는 참고용이며, 정확한 세액은 관할 세무서나 전문기관에 문의하시기 바랍니다.
                </p>
            </div>

            <!-- 광고 공간 (구글 애드센스) -->
            <div class="ad-container">
                <div class="ad-placeholder">
                    <p>광고</p>
                    <span>Google AdSense</span>
                </div>
            </div>
        </div>

        <!-- 하단 카피라이트 -->
        <div class="footer">
            <div class="footer-content">
                <p>&copy; 2025 전기차 스마트 계산기. All rights reserved.</p>
                <p>본 서비스는 전기차 구매를 고려하는 분들을 위한 참고용 계산기입니다.</p>
                <div class="footer-links">
                    <a href="#" onclick="showPrivacyPolicy()">개인정보처리방침</a>
                    <span>|</span>
                    <a href="#" onclick="showTerms()">이용약관</a>
                    <span>|</span>
                    <a href="mailto:contact@ev-calculator.com">문의하기</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let nationalSubsidyData = [];
        let localSubsidyData = [];
        let selectedVehicle = null;
        let currentTab = 'list';

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 시작...');
            loadMockData();
            populateLocalSubsidyOptions();
            setupCustomVehicleSearch();
            
            // 약간의 지연 후 차량 목록 생성 (DOM이 완전히 로드된 후)
            setTimeout(() => {
                populateVehicleList();
                console.log('초기화 완료');
            }, 100);
        });

        // 직접 입력 검색 기능 설정
        function setupCustomVehicleSearch() {
            const customInput = document.getElementById('customVehicleName');
            const customSuggestions = document.getElementById('customVehicleSuggestions');

            if (!customInput || !customSuggestions) return;

            customInput.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length >= 2) {
                    showCustomVehicleSuggestions(query);
                } else {
                    hideCustomSuggestions();
                }
            });

            customInput.addEventListener('focus', function() {
                if (this.value.length >= 2) {
                    showCustomVehicleSuggestions(this.value);
                }
            });

            document.addEventListener('click', function(e) {
                if (!customInput.contains(e.target) && !customSuggestions.contains(e.target)) {
                    hideCustomSuggestions();
                }
            });
        }

        // 직접 입력용 차량 제안 표시
        function showCustomVehicleSuggestions(query) {
            const suggestions = document.getElementById('customVehicleSuggestions');
            if (!suggestions) return;

            const filtered = nationalSubsidyData.filter(vehicle => 
                vehicle.model.toLowerCase().includes(query.toLowerCase()) ||
                vehicle.manufacturer.toLowerCase().includes(query.toLowerCase())
            );

            if (filtered.length > 0) {
                suggestions.innerHTML = filtered.map(vehicle => {
                    const displayText = `${vehicle.manufacturer} ${vehicle.model}`;
                    const highlightedText = highlightSearchTerm(displayText, query);
                    
                    return `<div class="suggestion-item" onclick="selectFromCustomSuggestion('${vehicle.manufacturer}', '${vehicle.model}', ${vehicle.subsidy})">
                        ${highlightedText}
                        <div style="font-size: 0.8rem; color: #64748b; margin-top: 2px;">국고보조금: ${vehicle.subsidy}만원</div>
                    </div>`;
                }).join('');
                suggestions.style.display = 'block';
            } else {
                suggestions.innerHTML = '<div class="suggestion-item">검색 결과가 없습니다</div>';
                suggestions.style.display = 'block';
            }
        }

        // 검색어 하이라이트 기능
        function highlightSearchTerm(text, term) {
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<span class="suggestion-highlight">$1</span>');
        }

        // 직접 입력 제안에서 선택
        function selectFromCustomSuggestion(manufacturer, model, subsidy) {
            selectedVehicle = { manufacturer, model, subsidy };
            document.getElementById('customVehicleName').value = `${manufacturer} ${model}`;
            showSelectedVehicleInfo(`${manufacturer} ${model}`, subsidy);
            hideCustomSuggestions();
        }

        // 직접 입력 제안 숨기기
        function hideCustomSuggestions() {
            const suggestions = document.getElementById('customVehicleSuggestions');
            if (suggestions) {
                suggestions.style.display = 'none';
            }
        }

        // 차량 탭 전환
        function switchVehicleTab(tab) {
            currentTab = tab;
            
            // 탭 버튼 활성화 상태 변경
            document.querySelectorAll('.vehicle-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchVehicleTab('${tab}')"]`).classList.add('active');
            
            // 탭 패널 표시/숨김
            document.querySelectorAll('.vehicle-tab-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
            
            // 차량 목록 탭 선택 시 목록이 비어있으면 다시 생성
            if (tab === 'list') {
                const vehicleList = document.getElementById('vehicleList');
                if (!vehicleList.innerHTML.trim()) {
                    populateVehicleList();
                }
            }
        }

        // 차량 선택 초기화
        function clearVehicleSelection() {
            selectedVehicle = null;
            document.getElementById('selectedVehicleInfo').style.display = 'none';
            
            // 목록에서 선택된 항목 해제
            document.querySelectorAll('.vehicle-item').forEach(item => item.classList.remove('selected'));
        }

        // 직접 입력 선택 초기화
        function clearCustomSelection() {
            document.getElementById('customVehicleName').value = '';
            clearVehicleSelection();
            hideCustomSuggestions();
        }

        // 모의 데이터 로드
        function loadMockData() {
            console.log('데이터 로드 중...');
            nationalSubsidyData = [
                // 현대자동차 - 제네시스
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 2WD 19인치', subsidy: 287 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 AWD 19인치', subsidy: 261 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 AWD 20인치', subsidy: 251 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 퍼포먼스 AWD 21인치', subsidy: 236 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 퍼포먼스 AWD 21인치(2025)', subsidy: 248 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 AWD 20인치(2025)', subsidy: 266 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 AWD 19인치(2025)', subsidy: 277 },
                { type: '승용', manufacturer: '현대자동차', model: 'GV60 스탠다드 2WD 19인치(2025)', subsidy: 290 },
                { type: '승용', manufacturer: '현대자동차', model: 'Electrified GV70 AWD 20인치', subsidy: 244 },
                { type: '승용', manufacturer: '현대자동차', model: 'Electrified GV70 AWD 19인치', subsidy: 260 },
                { type: '승용', manufacturer: '현대자동차', model: 'Electrified GV70 AWD 20인치(2025)', subsidy: 250 },
                { type: '승용', manufacturer: '현대자동차', model: 'Electrified GV70 AWD 19인치(2025)', subsidy: 266 },
                { type: '승용', manufacturer: '현대자동차', model: 'Electrified G80 AWD 19인치(2025)', subsidy: 275 },
                
                // 현대자동차 - 아이오닉
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉6 스탠다드 2WD 18인치', subsidy: 635 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉6 롱레인지 2WD 18인치', subsidy: 686 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉6 롱레인지 2WD 20인치', subsidy: 680 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉6 롱레인지 AWD 18인치', subsidy: 686 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉6 롱레인지 AWD 20인치', subsidy: 647 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉5 N', subsidy: 232 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 2WD 롱레인지 19인치 빌트인 캠 미적용', subsidy: 659 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 2WD 롱레인지 19인치', subsidy: 656 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 2WD 롱레인지 20인치', subsidy: 651 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 AWD 롱레인지 20인치', subsidy: 624 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 AWD 롱레인지 19인치', subsidy: 650 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 AWD 롱레인지 N라인 20인치', subsidy: 602 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 2WD 롱레인지 N라인 20인치', subsidy: 633 },
                { type: '승용', manufacturer: '현대자동차', model: '더뉴아이오닉5 2WD 스탠다드 19인치', subsidy: 561 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉9 성능형 AWD', subsidy: 277 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉9 항속형 2WD', subsidy: 279 },
                { type: '승용', manufacturer: '현대자동차', model: '아이오닉9 항속형 AWD', subsidy: 276 },
                
                // 현대자동차 - 코나
                { type: '승용', manufacturer: '현대자동차', model: '코나 일렉트릭 2WD 스탠다드 17인치', subsidy: 573 },
                { type: '승용', manufacturer: '현대자동차', model: '코나 일렉트릭 2WD 롱레인지 17인치', subsidy: 623 },
                { type: '승용', manufacturer: '현대자동차', model: '코나 일렉트릭 2WD 롱레인지 19인치(빌트인 캠)', subsidy: 568 },
                { type: '승용', manufacturer: '현대자동차', model: '코나 일렉트릭 2WD 롱레인지 17인치(빌트인 캠)', subsidy: 623 },
                
                // 기아 - EV6
                { type: '승용', manufacturer: '기아', model: 'EV6 스탠다드 2WD 19인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV6 롱레인지 2WD 19인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV6 롱레인지 AWD 19인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV6 GT 21인치', subsidy: 232 },
                
                // 기아 - EV9
                { type: '승용', manufacturer: '기아', model: 'EV9 스탠다드 2WD 19인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV9 롱레인지 2WD 20인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV9 롱레인지 AWD 20인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: 'EV9 GT-Line AWD 21인치', subsidy: 350 },
                
                // 기아 - 니로/레이
                { type: '승용', manufacturer: '기아', model: '니로 EV 스탠다드 17인치', subsidy: 680 },
                { type: '승용', manufacturer: '기아', model: '니로 EV 롱레인지 17인치', subsidy: 680 },
                { type: '경차', manufacturer: '기아', model: '레이 EV', subsidy: 680 },
                
                // BMW
                { type: '승용', manufacturer: 'BMW', model: 'i4 eDrive40', subsidy: 680 },
                { type: '승용', manufacturer: 'BMW', model: 'i4 M50', subsidy: 350 },
                { type: '승용', manufacturer: 'BMW', model: 'iX xDrive40', subsidy: 680 },
                { type: '승용', manufacturer: 'BMW', model: 'iX M60', subsidy: 350 },
                { type: '승용', manufacturer: 'BMW', model: 'i7 xDrive60', subsidy: 200 },
                
                // 테슬라
                { type: '승용', manufacturer: '테슬라', model: 'Model 3 RWD', subsidy: 680 },
                { type: '승용', manufacturer: '테슬라', model: 'Model 3 Long Range AWD', subsidy: 680 },
                { type: '승용', manufacturer: '테슬라', model: 'Model 3 Performance', subsidy: 350 },
                { type: '승용', manufacturer: '테슬라', model: 'Model Y RWD', subsidy: 680 },
                { type: '승용', manufacturer: '테슬라', model: 'Model Y Long Range AWD', subsidy: 680 },
                { type: '승용', manufacturer: '테슬라', model: 'Model Y Performance', subsidy: 350 },
                { type: '승용', manufacturer: '테슬라', model: 'Model S', subsidy: 200 },
                { type: '승용', manufacturer: '테슬라', model: 'Model X', subsidy: 200 },
                
                // 기타 브랜드
                { type: '승용', manufacturer: '메르세데스-벤츠', model: 'EQC 400 4MATIC', subsidy: 350 },
                { type: '승용', manufacturer: '메르세데스-벤츠', model: 'EQS 450+', subsidy: 200 },
                { type: '승용', manufacturer: '메르세데스-벤츠', model: 'EQE 350+', subsidy: 350 },
                { type: '승용', manufacturer: '볼보', model: 'XC40 Recharge', subsidy: 680 },
                { type: '승용', manufacturer: '볼보', model: 'C40 Recharge', subsidy: 680 },
                { type: '승용', manufacturer: '폴스타', model: 'Polestar 2', subsidy: 680 },
                { type: '승용', manufacturer: '폴스타', model: 'Polestar 3', subsidy: 350 },
                { type: '승용', manufacturer: '아우디', model: 'e-tron GT', subsidy: 350 },
                { type: '승용', manufacturer: '아우디', model: 'Q4 e-tron', subsidy: 680 },
                { type: '승용', manufacturer: '포르쉐', model: 'Taycan', subsidy: 350 },
                { type: '승용', manufacturer: '포르쉐', model: 'Macan Electric', subsidy: 350 }
            ];

            localSubsidyData = [
                { region: '서울특별시', subsidy: 400 },
                { region: '부산광역시', subsidy: 300 },
                { region: '대구광역시', subsidy: 250 },
                { region: '인천광역시', subsidy: 350 },
                { region: '광주광역시', subsidy: 200 },
                { region: '대전광역시', subsidy: 300 },
                { region: '울산광역시', subsidy: 400 },
                { region: '세종특별자치시', subsidy: 500 },
                { region: '경기도', subsidy: 300 },
                { region: '강원도', subsidy: 400 },
                { region: '충청북도', subsidy: 350 },
                { region: '충청남도', subsidy: 300 },
                { region: '전라북도', subsidy: 400 },
                { region: '전라남도', subsidy: 450 },
                { region: '경상북도', subsidy: 300 },
                { region: '경상남도', subsidy: 350 },
                { region: '제주특별자치도', subsidy: 600 }
            ];
            
            console.log(`데이터 로드 완료: 국고보조금 ${nationalSubsidyData.length}개, 지자체보조금 ${localSubsidyData.length}개`);
        }

        // 차량 목록 생성
        function populateVehicleList() {
            const vehicleList = document.getElementById('vehicleList');
            if (!vehicleList) {
                console.error('vehicleList 요소를 찾을 수 없습니다.');
                return;
            }
            
            vehicleList.innerHTML = '';
            
            if (nationalSubsidyData.length === 0) {
                vehicleList.innerHTML = '<div class="vehicle-item">차량 데이터를 불러오는 중...</div>';
                return;
            }
            
            // 선택 안함 옵션 추가
            const noSelectionItem = document.createElement('div');
            noSelectionItem.className = 'vehicle-item no-selection';
            noSelectionItem.onclick = () => selectVehicleFromList(null, noSelectionItem);
            noSelectionItem.innerHTML = `
                <div class="vehicle-name">선택 안함</div>
                <div class="vehicle-subsidy subsidy-none">국고 보조금: 0만원</div>
            `;
            vehicleList.appendChild(noSelectionItem);
            
            nationalSubsidyData.forEach((vehicle, index) => {
                const vehicleItem = document.createElement('div');
                vehicleItem.className = 'vehicle-item';
                vehicleItem.onclick = () => selectVehicleFromList(vehicle, vehicleItem);
                
                // 보조금 금액에 따른 색상 클래스 결정
                let subsidyClass = 'subsidy-high'; // 기본 높은 보조금
                if (vehicle.subsidy < 300) {
                    subsidyClass = 'subsidy-low'; // 낮은 보조금 (300만원 미만)
                } else if (vehicle.subsidy < 500) {
                    subsidyClass = 'subsidy-medium'; // 중간 보조금 (300-500만원)
                }
                
                vehicleItem.innerHTML = `
                    <div class="vehicle-name">${vehicle.manufacturer} ${vehicle.model}</div>
                    <div class="vehicle-subsidy ${subsidyClass}">국고 보조금: ${vehicle.subsidy}만원</div>
                `;
                
                vehicleList.appendChild(vehicleItem);
            });
            
            console.log(`차량 목록 생성 완료: ${nationalSubsidyData.length}개 차량`);
        }

        // 목록에서 차량 선택
        function selectVehicleFromList(vehicle, element) {
            // 이전 선택 해제
            document.querySelectorAll('.vehicle-item').forEach(item => item.classList.remove('selected'));
            
            // 현재 선택 표시
            element.classList.add('selected');
            
            // 차량 정보 저장
            selectedVehicle = vehicle;
            
            // 선택된 차량 정보 표시
            if (vehicle) {
                showSelectedVehicleInfo(`${vehicle.manufacturer} ${vehicle.model}`, vehicle.subsidy);
            } else {
                // 선택 안함의 경우
                showSelectedVehicleInfo('선택 안함', 0);
            }
        }

        // 직접 입력 차량 선택
        function selectCustomVehicle() {
            const customName = document.getElementById('customVehicleName').value.trim();
            const customSubsidyInput = document.getElementById('customSubsidy').value;
            
            if (!customName && !customSubsidyInput) {
                showError('차량 모델명 또는 보조금을 입력해주세요.');
                return;
            }
            
            let finalSubsidy = 680; // 기본값
            
            // 직접 입력된 보조금이 있으면 우선 적용
            if (customSubsidyInput) {
                finalSubsidy = parseInt(customSubsidyInput);
            } else {
                // 입력된 이름과 정확히 일치하는 차량 찾기
                const exactMatch = nationalSubsidyData.find(vehicle => 
                    `${vehicle.manufacturer} ${vehicle.model}`.toLowerCase() === customName.toLowerCase()
                );
                
                if (exactMatch) {
                    finalSubsidy = exactMatch.subsidy;
                }
            }
            
            selectedVehicle = {
                manufacturer: '사용자 입력',
                model: customName || '직접 입력',
                subsidy: finalSubsidy,
                type: '승용'
            };
            
            showSelectedVehicleInfo(customName || '직접 입력', finalSubsidy);
            hideCustomSuggestions();
        }

        // 취득세 계산
        function calculateTax() {
            // 입력값 검증
            const vehiclePrice = parseInt(document.getElementById('vehiclePrice').value) || 0;
            const vehicleType = document.getElementById('vehicleType').value;
            const localSubsidyAmount = parseInt(document.getElementById('localSubsidy').value) || 0;

            if (!vehiclePrice) {
                showError('차량 가액을 입력해주세요.');
                return;
            }

            if (!vehicleType) {
                showError('차량 종류를 선택해주세요.');
                return;
            }

            // 세율 설정
            const taxRates = {
                'passenger': 0.07,
                'van': 0.05,
                'truck': 0.05,
                'commercial': 0.04
            };

            // 보조금 계산
            let nationalSubsidy = 0;
            if (selectedVehicle) {
                nationalSubsidy = selectedVehicle.subsidy;
            }

            // 보조금 지원 기준 적용
            let subsidyRate = 1;
            if (vehiclePrice >= 8500) {
                subsidyRate = 0;
            } else if (vehiclePrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(nationalSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(localSubsidyAmount * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // 기본 취득세 계산
            const taxRate = taxRates[vehicleType];
            const baseTax = Math.floor(vehiclePrice * taxRate);

            // 감면 계산
            let taxReduction = 0;
            const currentYear = new Date().getFullYear();
            
            if (selectedVehicle && (selectedVehicle.model.includes('레이') || selectedVehicle.type === '경차')) {
                const miniCarTax = Math.floor(vehiclePrice * 0.04);
                taxReduction = Math.min(75, miniCarTax);
            } else {
                if (currentYear <= 2026) {
                    taxReduction = Math.min(140, baseTax);
                } else if (currentYear === 2027) {
                    taxReduction = Math.min(100, baseTax);
                }
            }

            // 최종 취득세 계산
            const finalTax = Math.max(0, baseTax - taxReduction);

            // 결과 표시
            displayResults({
                nationalSubsidy: finalNationalSubsidy,
                localSubsidy: finalLocalSubsidy,
                totalSubsidy: totalSubsidy,
                baseTax: baseTax,
                taxReduction: taxReduction,
                finalTax: finalTax
            });

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // 개인정보처리방침 모달
        function showPrivacyPolicy() {
            alert('개인정보처리방침\n\n본 계산기는 사용자의 개인정보를 수집하지 않습니다.\n입력된 차량 정보와 계산 결과는 로컬에서만 처리되며 서버에 저장되지 않습니다.\n\n문의사항이 있으시면 contact@ev-calculator.com으로 연락주세요.');
        }

        // 이용약관 모달  
        function showTerms() {
            alert('이용약관\n\n1. 본 계산기는 참고용으로 제공되며, 실제 세액과 차이가 있을 수 있습니다.\n2. 정확한 세액은 관할 세무서나 전문기관에 문의하시기 바랍니다.\n3. 보조금 정보는 수시로 변경될 수 있으므로 구매 전 공식 사이트에서 확인하세요.\n4. 본 서비스 이용으로 인한 손해에 대해 책임지지 않습니다.\n\n서비스 이용 시 위 약관에 동의하는 것으로 간주합니다.');
        }

        // 선택된 차량 정보 표시
        function showSelectedVehicleInfo(name, subsidy) {
            document.getElementById('selectedVehicleName').textContent = name;
            document.getElementById('selectedVehicleSubsidy').textContent = subsidy;
            document.getElementById('selectedVehicleInfo').style.display = 'block';
        }

        // 지자체 보조금 옵션 생성
        function populateLocalSubsidyOptions() {
            const select = document.getElementById('localSubsidy');
            // 기본 옵션들 유지하고 지역 옵션들만 추가
            const existingOptions = select.innerHTML;
            
            localSubsidyData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.subsidy;
                option.textContent = `${item.region} (${item.subsidy}만원)`;
                select.appendChild(option);
            });
        }

        // 가격 조작 함수들
        function addPrice(amount) {
            const priceInput = document.getElementById('vehiclePrice');
            const currentValue = parseInt(priceInput.value) || 0;
            priceInput.value = currentValue + amount;
        }

        function clearPrice() {
            document.getElementById('vehiclePrice').value = '';
        }

        // 결과 표시
        function displayResults(results) {
            document.getElementById('nationalSubsidy').innerHTML = `<span class="result-icon">💰</span>${results.nationalSubsidy.toLocaleString()}만원`;
            document.getElementById('localSubsidyAmount').innerHTML = `<span class="result-icon">🏛️</span>${results.localSubsidy.toLocaleString()}만원`;
            document.getElementById('totalSubsidy').innerHTML = `<span class="result-icon">💎</span>${results.totalSubsidy.toLocaleString()}만원`;
            document.getElementById('baseTax').innerHTML = `<span class="result-icon">📋</span>${results.baseTax.toLocaleString()}만원`;
            document.getElementById('taxReduction').innerHTML = `<span class="result-icon">🎁</span>${results.taxReduction.toLocaleString()}만원`;
            document.getElementById('finalTax').innerHTML = `<span>💸</span>${results.finalTax.toLocaleString()}만원`;
        }

        // 에러 표시
        function showError(message) {
            const existingError = document.querySelector('.error');
            if (existingError) {
                existingError.remove();
            }

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const calculateBtn = document.querySelector('.calculate-btn');
            calculateBtn.parentNode.insertBefore(errorDiv, calculateBtn);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>