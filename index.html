<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전기차 스마트 계산기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .page-wrapper {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-container {
            min-width: 0;
        }

        .container {
            max-width: 900px;
            margin: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }


        .main-content {
            padding: 40px;
        }

        .sidebar-calculator {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: fit-content;
            position: sticky;
            top: 80px;
            margin-top: 60px;
        }

        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quick-calculator {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .quick-calc-header {
            background: #1e293b;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .quick-calc-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quick-calc-body {
            padding: 20px;
        }

        .quick-input-group {
            margin-bottom: 16px;
        }

        .quick-input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 6px;
        }

        .quick-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .quick-calc-btn {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .quick-calc-btn:hover {
            background: #2563eb;
        }

        .quick-results {
            display: none;
        }

        .quick-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
        }

        .quick-result-item:last-child {
            border-bottom: none;
        }

        .quick-result-label {
            color: #64748b;
            font-weight: 500;
        }

        .quick-result-value {
            font-weight: 600;
            color: #1e293b;
        }

        .quick-result-value.positive {
            color: #059669;
        }

        .quick-final-result {
            background: #1e293b;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
        }

        .quick-final-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .quick-final-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .vehicle-selection {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .vehicle-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .vehicle-tab {
            flex: 1;
            padding: 12px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .vehicle-tab.active {
            background: white;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
        }

        .vehicle-tab-content {
            padding: 16px;
            background: white;
        }

        .vehicle-tab-panel {
            display: none;
        }

        .vehicle-tab-panel.active {
            display: block;
        }

        .vehicle-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .vehicle-item {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vehicle-item:hover {
            background: #f8fafc;
        }

        .vehicle-item:last-child {
            border-bottom: none;
        }

        .vehicle-item.selected {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }

        .no-selection-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .no-selection-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .no-selection-item.selected {
            background: #f1f5f9;
            border-color: #64748b;
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.1);
        }

        .no-selection-text {
            font-weight: 600;
            color: #64748b;
            font-size: 1rem;
        }

        .vehicle-name {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.95rem;
            line-height: 1.4;
            flex: 1;
        }

        .vehicle-subsidy {
            font-size: 0.85rem;
            font-weight: 500;
            min-width: 120px;
            text-align: right;
        }

        .subsidy-high {
            color: #059669;
        }

        .subsidy-medium {
            color: #d97706;
        }

        .subsidy-low {
            color: #dc2626;
        }

        .subsidy-none {
            color: #64748b;
        }

        .manufacturer-selection {
            margin-bottom: 16px;
        }

        .price-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-input {
            flex: 1;
            text-align: right;
        }

        .price-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .price-btn {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .price-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calculate-btn:hover {
            background: #2563eb;
        }

        .result-section {
            background: #ffffff;
            padding: 40px;
            border-radius: 16px;
            margin-top: 32px;
            display: none;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .result-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .result-item {
            background: #f8fafc;
            padding: 24px 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .result-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }

        .result-item.subsidy {
            background: linear-gradient(135deg, #f0fdf4 0%, #f7fee7 100%);
            border-color: #bbf7d0;
        }

        .result-item.tax {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #fecaca;
        }

        .result-item.reduction {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #d8b4fe;
        }

        .result-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .result-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            line-height: 1.2;
        }

        .result-value.positive {
            color: #059669;
        }

        .result-value.negative {
            color: #dc2626;
        }

        .result-icon {
            font-size: 1.2rem;
        }

        .payment-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: stretch;
        }

        .calculation-breakdown {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: 100%;
            min-height: 200px;
        }

        .calculation-breakdown h4 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 0.95rem;
        }

        .breakdown-label {
            color: #475569;
            font-weight: 500;
        }

        .breakdown-value {
            color: #1e293b;
            font-weight: 600;
        }

        .breakdown-add .breakdown-label {
            color: #dc2626;
        }

        .breakdown-subtract .breakdown-label {
            color: #059669;
        }

        .breakdown-divider {
            height: 1px;
            background: #e2e8f0;
            margin: 12px 0;
        }

        .breakdown-result {
            border-top: 2px solid #3b82f6;
            padding-top: 12px !important;
            margin-top: 8px;
        }

        .breakdown-result .breakdown-label {
            color: #1e293b;
            font-weight: 700;
            font-size: 1rem;
        }

        .breakdown-result .breakdown-value {
            color: #3b82f6;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .final-result {
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            color: white;
            padding: 32px 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(30, 41, 59, 0.2);
            height: 100%;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .final-label {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            font-weight: 500;
            line-height: 1.3;
            text-align: center;
            width: 100%;
        }

        .final-value {
            font-size: 2.4rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            line-height: 1.1;
            text-align: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .final-value span {
            font-size: 2.0rem;
        }

        .info-box-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
        }

        .info-box h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 0.925rem;
        }

        .info-box ul {
            margin-left: 16px;
            color: #0c4a6e;
            font-size: 0.875rem;
        }

        .info-box ul li {
            margin-bottom: 4px;
        }

        .status-indicator {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 0.875rem;
        }

        .status-indicator.working {
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        .status-indicator.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #dc2626;
        }

        .vehicle-count {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 8px;
            text-align: right;
        }

        .footer-info {
            background: #f1f5f9;
            padding: 24px;
            margin-top: 32px;
            border-radius: 8px;
            border-top: 3px solid #3b82f6;
        }

        .footer-info h4 {
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .footer-info p {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }

        .footer-info a {
            color: #3b82f6;
            text-decoration: none;
        }

        .footer-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .page-wrapper {
                display: block;
                padding: 10px;
            }
            
            /* 모바일에서 빠른 계산기 숨기기 */
            .right-sidebar {
                display: none;
            }
            
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .main-content {
                padding: 24px;
            }

            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .price-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .result-item {
                min-height: 100px;
                padding: 20px 16px;
            }

            .result-value {
                font-size: 1.3rem;
            }

            .payment-summary {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .vehicle-tabs {
                flex-direction: column;
            }

            .info-box-container {
                grid-template-columns: 1fr;
            }

            .vehicle-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .vehicle-subsidy {
                text-align: left;
                min-width: auto;
            }

            .final-result {
                min-height: 180px;
                padding: 24px 20px;
            }

            .final-label {
                font-size: 1.0rem;
                margin-bottom: 16px;
            }

            .final-value {
                font-size: 2.0rem;
                flex-direction: column;
                gap: 8px;
            }

            .final-value span {
                font-size: 1.6rem;
            }

            .breakdown-item {
                font-size: 0.875rem;
            }
        }

        @media (max-width: 1200px) {
            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="main-container">
            <div class="container">

                <div class="main-content">
                    <!-- 필수 정보 입력 -->
                    <div class="section">
                        
                        <div class="form-group">
                            <label class="form-label required">연도 선택</label>
                            <select id="dataYear" class="input" onchange="loadYearData()">
                                <option value="">데이터 로딩 중...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">차량 선택 (국고 보조금 자동 적용)</label>
                            <div class="vehicle-selection">
                                <div class="vehicle-tabs">
                                    <button class="vehicle-tab active" onclick="switchVehicleTab('list')">차량 목록에서 선택</button>
                                    <button class="vehicle-tab" onclick="switchVehicleTab('direct')">직접 입력</button>
                                </div>
                                
                                <div class="vehicle-tab-content">
                                    <!-- 차량 목록 탭 -->
                                    <div id="list-tab" class="vehicle-tab-panel active">
                                        <!-- 제조사 선택 -->
                                        <div class="manufacturer-selection">
                                            <label class="form-label">제조사 선택</label>
                                            <select id="manufacturerFilter" class="input" onchange="filterByManufacturer()">
                                                <option value="">전체 제조사</option>
                                            </select>
                                        </div>
                                        
                                        <div class="vehicle-count" id="vehicleCount">데이터 로딩 중...</div>
                                        <div class="vehicle-list" id="vehicleList">
                                            <div class="vehicle-item">
                                                <div class="vehicle-name">차량 데이터를 불러오는 중입니다...</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 직접 입력 탭 -->
                                    <div id="direct-tab" class="vehicle-tab-panel">
                                        <div style="margin-top: 16px;">
                                            <label class="form-label">국고 보조금 직접 입력 (만원)</label>
                                            <input type="number" id="customSubsidy" class="input" 
                                                   placeholder="보조금 금액을 입력하세요 (예: 680)" min="0" step="1" />
                                            <p style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                                * 차량 목록에 없는 모델의 경우 직접 보조금을 입력할 수 있습니다.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="selectedVehicleInfo" style="margin-top: 12px; padding: 12px; background: #f0f9ff; border-radius: 6px; display: none;">
                                <strong>선택된 차량:</strong> <span id="selectedVehicleName"></span><br>
                                <strong>국고 보조금:</strong> <span id="selectedVehicleSubsidy"></span>만원
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">차량 가액 (만원)</label>
                            <div class="price-input-container">
                                <input type="number" id="vehiclePrice" class="input price-input" 
                                       placeholder="차량 가격을 입력하세요" min="0" step="1" oninput="syncQuickCalc()" />
                                <span>만원</span>
                            </div>
                            <div class="price-buttons">
                                <button class="price-btn" onclick="addPrice(1000)">+ 1,000만</button>
                                <button class="price-btn" onclick="addPrice(500)">+ 500만</button>
                                <button class="price-btn" onclick="addPrice(100)">+ 100만</button>
                                <button class="price-btn" onclick="addPrice(50)">+ 50만</button>
                                <button class="price-btn" onclick="addPrice(10)">+ 10만</button>
                                <button class="price-btn" onclick="clearPrice()">초기화</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">차량 종류</label>
                            <select id="vehicleType" class="input" onchange="syncQuickCalc()">
                                <option value="passenger" selected>승용차 (7%)</option>
                                <option value="compact">경차 (4% + 75만원 감면)</option>
                                <option value="van">승합차 (5%)</option>
                                <option value="truck">화물차 (5%)</option>
                                <option value="commercial">영업용 자동차 (4%)</option>
                            </select>
                        </div>
                    </div>

                    <!-- 선택 정보 입력 -->
                    <div class="section">
                        
                        <div class="form-group">
                            <label class="form-label">지역 선택 (지자체 보조금)</label>
                            <div class="vehicle-selection">
                                <div class="vehicle-tabs">
                                    <button class="vehicle-tab active" onclick="switchLocalSubsidyTab('region')">지역별 보조금</button>
                                    <button class="vehicle-tab" onclick="switchLocalSubsidyTab('manual')">직접 입력</button>
                                </div>
                                
                                <div class="vehicle-tab-content">
                                    <!-- 지역별 보조금 탭 -->
                                    <div id="region-tab" class="vehicle-tab-panel active">
                                        <div style="margin-top: 16px;">
                                            <div class="info-text" style="font-size: 0.875rem; color: #64748b; margin-bottom: 8px;">
                                                * 차량을 먼저 선택하면 해당 차량의 지역별 보조금이 표시됩니다
                                            </div>
                                            <select id="localSubsidy" class="input" onchange="syncQuickCalc()">
                                                <option value="0">지역을 선택하세요</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- 직접 입력 탭 -->
                                    <div id="manual-tab" class="vehicle-tab-panel">
                                        <div style="margin-top: 16px;">
                                            <label class="form-label">지자체 보조금 직접 입력 (만원)</label>
                                            <input type="number" id="customLocalSubsidy" class="input" 
                                                   placeholder="지자체 보조금을 입력하세요 (예: 400)" min="0" step="1" value="0" 
                                                   oninput="syncQuickCalc()" />
                                            <p style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                                * 거주 지역의 지자체 보조금을 직접 입력할 수 있습니다.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-box-container">
                            <div class="info-box">
                                <h4>💰 보조금 지원 기준</h4>
                                <ul>
                                    <li><strong>전액 지원:</strong> 차량 가액 5,300만원 미만</li>
                                    <li><strong>50% 지원:</strong> 5,300만원 이상 ~ 8,500만원 미만</li>
                                    <li><strong>미지원:</strong> 8,500만원 이상</li>
                                </ul>
                            </div>
                            <div class="info-box">
                                <h4>🏷️ 취득세 감면 혜택</h4>
                                <ul>
                                    <li><strong>경차:</strong> 4% 적용 후 75만원 감면</li>
                                    <li><strong>일반 전기차:</strong> 2026년까지 140만원, 2027년 100만원 감면</li>
                                    <li><strong>플러그인 하이브리드:</strong> 40만원 감면</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculateTax()">
                        계산하기
                    </button>

                    <!-- 결과 표시 영역 -->
                    <div id="resultSection" class="result-section">
                        <h3 class="result-title">
                            📊 계산 결과
                        </h3>
                        
                        <div class="result-grid">
                            <div class="result-item subsidy">
                                <div class="result-label">국고 보조금</div>
                                <div class="result-value positive" id="nationalSubsidy">
                                    <span class="result-icon">💰</span>0만원
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">지자체 보조금</div>
                                <div class="result-value positive" id="localSubsidyAmount">
                                    <span class="result-icon">🏛️</span>0만원
                                </div>
                            </div>
                            <div class="result-item subsidy">
                                <div class="result-label">총 보조금</div>
                                <div class="result-value positive" id="totalSubsidy">
                                    <span class="result-icon">💎</span>0만원
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">기본 취득세</div>
                                <div class="result-value" id="baseTax">
                                    <span class="result-icon">📋</span>0만원
                                </div>
                            </div>
                            <div class="result-item reduction">
                                <div class="result-label">감면 혜택</div>
                                <div class="result-value positive" id="taxReduction">
                                    <span class="result-icon">🎁</span>0만원
                                </div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">최종 취득세</div>
                                <div class="result-value" id="finalTaxInGrid">
                                    <span class="result-icon">💸</span>0만원
                                </div>
                            </div>
                        </div>

                        <!-- 총 지불금액과 계산 요약 -->
                        <div class="payment-summary">
                            <div class="calculation-breakdown">
                                <h4>💡 계산 요약</h4>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">차량 가격</span>
                                    <span class="breakdown-value" id="vehiclePriceDisplay">0만원</span>
                                </div>
                                <div class="breakdown-item breakdown-add">
                                    <span class="breakdown-label">+ 최종 취득세</span>
                                    <span class="breakdown-value" id="finalTaxDisplay">0만원</span>
                                </div>
                                <div class="breakdown-item breakdown-subtract">
                                    <span class="breakdown-label">- 총 보조금</span>
                                    <span class="breakdown-value" id="totalSubsidyDisplay">0만원</span>
                                </div>
                                <div class="breakdown-divider"></div>
                                <div class="breakdown-item breakdown-result">
                                    <span class="breakdown-label">실제 지불 금액</span>
                                    <span class="breakdown-value" id="totalPaymentBreakdown">0만원</span>
                                </div>
                            </div>
                            
                            <div class="final-result">
                                <div class="final-label">총 차량 지불 금액</div>
                                <div class="final-value" id="totalPayment">
                                    <span>🏦</span>0만원
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 하단 안내 정보 -->
                    <div class="footer-info">
                        <h4>📌 더 자세한 정보 확인</h4>
                        <p><strong>정확한 보조금 확인:</strong> <a href="https://www.ev.or.kr/nportal/buySupprt/initBuySubsidySupprtAction.do" target="_blank">전기차 누리집</a></p>
                        <p>• 국고 보조금: 구매 및 지원 → 구매보조금 지원 → 국고 보조금</p>
                        <p>• 지자체 보조금: 구매 및 지원 → 구매보조금 지원 → 지자체 보조금</p>
                        <p>• 구매보조금 지급현황: 구매 및 지원 → 구매보조금 지급현황</p>
                        <p style="margin-top: 12px; font-size: 0.8rem; color: #64748b;">
                            * 본 계산기는 참고용이며, 정확한 세액은 관할 세무서나 전문기관에 문의하시기 바랍니다.
                        </p>
                        <p style="font-size: 0.8rem; color: #64748b;">
                            * 차량 데이터는 선택된 연도 기준이며, 최신 정보는 전기차 누리집에서 확인하세요.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 우측 사이드바 (빠른 계산기) -->
        <div class="right-sidebar">
            <div class="sidebar-calculator">
                <div class="quick-calculator">
                    <div class="quick-calc-header">
                        <h3>🚀 빠른 계산</h3>
                    </div>
                    <div class="quick-calc-body">
                        <div class="quick-input-group">
                            <label>차량 가격 (만원)</label>
                            <input type="number" id="quickPrice" class="quick-input" placeholder="가격 입력" min="0" step="1">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>국고 보조금 (만원)</label>
                            <input type="number" id="quickSubsidy" class="quick-input" placeholder="보조금 입력" min="0" step="1" value="0">
                        </div>
                        
                        <div class="quick-input-group">
                            <label>지자체 보조금 (만원)</label>
                            <input type="number" id="quickLocal" class="quick-input" placeholder="지역 보조금" min="0" step="1" value="0">
                        </div>
                        
                        <button class="quick-calc-btn" onclick="quickCalculate()">
                            ⚡ 즉시 계산
                        </button>
                        
                        <div id="quickResults" class="quick-results">
                            <div class="quick-result-item">
                                <span class="quick-result-label">국고 보조금</span>
                                <span class="quick-result-value positive" id="quickNationalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">지자체 보조금</span>
                                <span class="quick-result-value positive" id="quickLocalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">총 보조금</span>
                                <span class="quick-result-value positive" id="quickTotalSubsidy">0만원</span>
                            </div>
                            <div class="quick-result-item">
                                <span class="quick-result-label">취득세</span>
                                <span class="quick-result-value" id="quickTax">0만원</span>
                            </div>
                            
                            <div class="quick-final-result">
                                <div class="quick-final-label">총 지불 금액</div>
                                <div class="quick-final-value" id="quickFinalAmount">0만원</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let vehicleData = [];
        let regionData = [];
        let selectedVehicle = null;
        let currentTab = 'list';
        let currentLocalSubsidyTab = 'region';
        let filteredVehicles = [];

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 시작...');
            loadAvailableYears();
        });

        // 사용 가능한 연도 확인 및 로드
        async function loadAvailableYears() {
            try {
                console.log('사용 가능한 연도 확인 중...');
                
                // 사용 가능한 연도를 직접 지정 (CSV 파일이 있는 연도)
                const availableYears = [2024, 2025];
                
                // 연도 선택 옵션 생성
                populateYearOptions(availableYears);
                
                // 가장 최신 연도를 기본값으로 설정
                const defaultYear = availableYears[availableYears.length - 1];
                document.getElementById('dataYear').value = defaultYear;
                
                // 초기 데이터 로드
                await loadDataFromCSV();
                
            } catch (error) {
                console.error('초기화 실패:', error);
                document.getElementById('dataYear').innerHTML = '<option value="">데이터 로드 실패</option>';
            }
        }

        // 연도 옵션 생성
        function populateYearOptions(years) {
            const yearSelect = document.getElementById('dataYear');
            yearSelect.innerHTML = '';
            
            // 최신 연도부터 정렬
            years.sort((a, b) => b - a);
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}년`;
                yearSelect.appendChild(option);
            });
            
            console.log(`사용 가능한 연도: ${years.join(', ')}`);
        }

        // CSV에서 데이터 로드
        async function loadDataFromCSV() {
            try {
                console.log('CSV 데이터 로드 시작...');
                
                // 선택된 연도 기준 CSV 파일 경로
                const selectedYear = document.getElementById('dataYear').value;
                
                if (!selectedYear) {
                    console.log('선택된 연도가 없습니다');
                    return;
                }
                
                const csvPath = `csv/${selectedYear}.csv`;
                
                console.log(`CSV 파일 경로: ${csvPath}`);
                
                // CSV 파일 가져오기
                const response = await fetch(csvPath);
                
                if (!response.ok) {
                    throw new Error(`CSV 파일 로드 실패: HTTP ${response.status} - ${csvPath}`);
                }
                
                const csvText = await response.text();
                console.log(`${selectedYear}년 CSV 데이터 크기:`, csvText.length);
                
                // CSV 파싱
                const data = parseCSV(csvText);
                console.log(`${selectedYear}년 파싱된 데이터 행 수:`, data.length);
                
                // 데이터 연도 필터링 (2024년은 데이터연도 컬럼이 없음)
                let filteredData;
                if (selectedYear == '2024') {
                    // 2024년은 모든 데이터 사용
                    filteredData = data;
                } else {
                    // 2025년 이후는 데이터연도 컬럼으로 필터링
                    filteredData = data.filter(row => row['데이터연도'] == selectedYear);
                }
                console.log(`${selectedYear}년 필터링된 데이터:`, filteredData.length);
                
                // 차량 데이터 처리
                processVehicleData(filteredData);
                
                // 지역 데이터 처리
                processRegionData(filteredData);
                
                // UI 업데이트
                populateManufacturerOptions();
                populateVehicleList();
                
                // 지역별 보조금 목록 초기화
                if (currentLocalSubsidyTab === 'region') {
                    updateLocalSubsidyOptions();
                }
                
                console.log(`${selectedYear}년 CSV 데이터 로드 완료`);
                
            } catch (error) {
                console.error('CSV 데이터 로드 실패:', error);
                // 에러 발생 시에도 기본 UI는 표시
                populateManufacturerOptions();
                populateVehicleList();
            }
        }

        // 연도 변경 시 데이터 재로드
        async function loadYearData() {
            const selectedYear = document.getElementById('dataYear').value;
            console.log(`${selectedYear}년 데이터로 변경`);
            
            // 기존 선택 초기화
            resetVehicleSelection();
            
            // 새 연도 데이터 로드
            await loadDataFromCSV();
        }

        // 차량 선택 초기화
        function resetVehicleSelection() {
            // 모든 선택 해제
            document.querySelectorAll('.vehicle-item, .no-selection-item').forEach(item => item.classList.remove('selected'));
            selectedVehicle = null;
            
            // 선택된 차량 정보 숨김
            document.getElementById('selectedVehicleInfo').style.display = 'none';
            
            // 지자체 보조금이 지역별 탭인 경우 초기화
            if (currentLocalSubsidyTab === 'region') {
                const localSubsidySelect = document.getElementById('localSubsidy');
                // 차량이 선택되지 않은 경우 전체 지역 목록 표시
                if (!selectedVehicle) {
                    updateLocalSubsidyOptions();
                }
                localSubsidySelect.value = 0;
            } else {
                // 직접 입력 탭인 경우 0으로 초기화
                document.getElementById('customLocalSubsidy').value = 0;
            }
            
            // 제조사 필터 초기화
            document.getElementById('manufacturerFilter').value = '';
            
            // 빠른 계산기 초기화
            document.getElementById('quickSubsidy').value = 0;
            document.getElementById('quickLocal').value = 0;
        }

        // CSV 파싱 함수
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                
                if (values.length >= headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
            }
            
            return data;
        }

        // 차량 데이터 처리
        function processVehicleData(data) {
            const vehicleMap = new Map();
            
            // 제조사 이름 매핑
            const nameMap = {
                '현대자동차': '현대',
                '기아자동차': '기아',
                '기아': '기아',
                '메르세데스벤츠코리아': '벤츠',
                '메르세데스-벤츠 코리아': '벤츠',
                '테슬라코리아': '테슬라',
                '테슬라': '테슬라',
                '폭스바겐그룹코리아': '폭스바겐',
                '포르쉐코리아': '포르쉐',
                '볼보자동차코리아': '볼보',
                '제네시스코리아': '제네시스'
            };
            
            data.forEach(row => {
                const originalManufacturer = row['제조사'];
                const manufacturer = nameMap[originalManufacturer] || originalManufacturer;
                const model = row['모델명'] || row['차종'];
                const nationalSubsidy = parseInt(row['국비보조금(만원)']) || 0;
                
                if (manufacturer && model && nationalSubsidy > 0) {
                    const vehicleKey = `${manufacturer}_${model}`;
                    
                    if (!vehicleMap.has(vehicleKey)) {
                        vehicleMap.set(vehicleKey, {
                            id: vehicleKey,
                            manufacturer: manufacturer,
                            model: model,
                            nationalSubsidy: nationalSubsidy,
                            regions: new Map()
                        });
                    }
                    
                    // 지역별 보조금 저장
                    const region = row['지역'];
                    const localSubsidy = parseInt(row['지방비보조금(만원)']) || 0;
                    
                    if (region && localSubsidy > 0) {
                        vehicleMap.get(vehicleKey).regions.set(region, localSubsidy);
                    }
                }
            });
            
            vehicleData = Array.from(vehicleMap.values());
            filteredVehicles = vehicleData;
            
            console.log(`차량 데이터 처리 완료: ${vehicleData.length}개`);
        }

        // 지역 데이터 처리
        function processRegionData(data) {
            const regionMap = new Map();
            
            data.forEach(row => {
                const region = row['지역'];
                const localSubsidy = parseInt(row['지방비보조금(만원)']) || 0;
                
                if (region && localSubsidy > 0) {
                    if (!regionMap.has(region)) {
                        regionMap.set(region, []);
                    }
                    regionMap.get(region).push(localSubsidy);
                }
            });
            
            regionData = [];
            regionMap.forEach((subsidies, region) => {
                // 평균 보조금 계산
                const avgSubsidy = Math.round(subsidies.reduce((sum, s) => sum + s, 0) / subsidies.length);
                regionData.push({
                    region: region,
                    subsidy: avgSubsidy,
                    count: subsidies.length
                });
            });
            
            // 지역 순서 정렬 (서울 -> 경기도 -> 광역시 -> 기타 순)
            const regionOrder = {
                '서울특별시': 1,
                '인천광역시': 2,
                '경기도': 3,
                '부산광역시': 4,
                '대구광역시': 5,
                '광주광역시': 6,
                '대전광역시': 7,
                '울산광역시': 8,
                '세종특별자치시': 9,
                '제주특별자치도': 99
            };
            
            regionData.sort((a, b) => {
                const orderA = regionOrder[a.region] || 50;
                const orderB = regionOrder[b.region] || 50;
                if (orderA !== orderB) return orderA - orderB;
                return a.region.localeCompare(b.region);
            });
            
            console.log(`지역 데이터 처리 완료: ${regionData.length}개`);
        }

        // 데이터 상태 업데이트 (함수 삭제됨)

        // 기본 데이터 로드 함수 제거됨

        // 제조사 옵션 생성
        function populateManufacturerOptions() {
            const select = document.getElementById('manufacturerFilter');
            if (!select) return;
            
            // 기존 옵션 제거 (첫 번째 제외)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            const manufacturers = [...new Set(vehicleData.map(vehicle => vehicle.manufacturer))];
            
            // 제조사 이름 간소화
            const nameMap = {
                '현대자동차': '현대',
                '기아자동차': '기아',
                '기아': '기아',
                '메르세데스벤츠코리아': '벤츠',
                '메르세데스-벤츠 코리아': '벤츠',
                '테슬라코리아': '테슬라',
                '테슬라': '테슬라',
                '폭스바겐그룹코리아': '폭스바겐',
                '포르쉐코리아': '포르쉐',
                '볼보자동차코리아': '볼보',
                '제네시스코리아': '제네시스'
            };
            
            // 제조사 정렬: 현대, 기아 우선, 그 다음 인기 제조사
            const priorityOrder = {
                '현대': 1,
                '기아': 2,
                'BMW': 3,
                '벤츠': 4,
                '테슬라': 5,
                '아우디': 6,
                '폭스바겐': 7,
                '볼보': 8,
                '포르쉐': 9,
                '제네시스': 10
            };
            
            manufacturers.sort((a, b) => {
                const displayA = nameMap[a] || a;
                const displayB = nameMap[b] || b;
                const orderA = priorityOrder[displayA] || 999;
                const orderB = priorityOrder[displayB] || 999;
                if (orderA !== orderB) return orderA - orderB;
                return displayA.localeCompare(displayB);
            });
            
            manufacturers.forEach(manufacturer => {
                const option = document.createElement('option');
                option.value = manufacturer;
                const displayName = nameMap[manufacturer] || manufacturer;
                option.textContent = displayName;
                select.appendChild(option);
            });
        }

        // 제조사별 필터링
        function filterByManufacturer() {
            const selectedManufacturer = document.getElementById('manufacturerFilter').value;
            
            if (selectedManufacturer) {
                filteredVehicles = vehicleData.filter(vehicle => vehicle.manufacturer === selectedManufacturer);
            } else {
                filteredVehicles = vehicleData;
            }
            
            populateVehicleList();
            updateVehicleCount(filteredVehicles.length);
        }

        // 차량 목록 생성
        function populateVehicleList() {
            const vehicleList = document.getElementById('vehicleList');
            if (!vehicleList) return;
            
            vehicleList.innerHTML = '';
            
            // 선택 안함 옵션 추가 (별도 박스)
            const noSelectionItem = document.createElement('div');
            noSelectionItem.className = 'no-selection-item';
            noSelectionItem.onclick = () => selectVehicleFromList(null, noSelectionItem);
            noSelectionItem.innerHTML = '<div class="no-selection-text">🚫 차량 선택 안함</div>';
            vehicleList.appendChild(noSelectionItem);
            
            if (filteredVehicles.length === 0) {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'vehicle-item';
                emptyItem.innerHTML = '<div class="vehicle-name">검색 결과가 없습니다.</div>';
                vehicleList.appendChild(emptyItem);
                return;
            }
            
            // 차량 정렬: 제조사별로 인기 모델 우선
            const vehiclePriority = {
                '현대': {'아이오닉 5': 1, '아이오닉 6': 2, '코나 Electric': 3, 'NEXO': 4},
                '기아': {'EV6': 1, 'EV9': 2, '니로 EV': 3, '봉고3 EV': 4},
                'BMW': {'i4': 1, 'iX': 2, 'i7': 3},
                '벤츠': {'EQE': 1, 'EQS': 2, 'EQA': 3},
                '테슬라': {'Model 3': 1, 'Model Y': 2, 'Model S': 3, 'Model X': 4}
            };
            
            filteredVehicles.sort((a, b) => {
                const manufacturerPriority = vehiclePriority[a.manufacturer] || {};
                const priorityA = manufacturerPriority[a.model] || 999;
                const priorityB = manufacturerPriority[b.model] || 999;
                if (priorityA !== priorityB) return priorityA - priorityB;
                return b.nationalSubsidy - a.nationalSubsidy; // 보조금 높은 순
            });
            
            filteredVehicles.forEach((vehicle) => {
                const vehicleItem = document.createElement('div');
                vehicleItem.className = 'vehicle-item';
                vehicleItem.onclick = () => selectVehicleFromList(vehicle, vehicleItem);
                
                // 보조금 금액에 따른 색상 클래스 결정
                let subsidyClass = 'subsidy-high';
                if (vehicle.nationalSubsidy < 300) {
                    subsidyClass = 'subsidy-low';
                } else if (vehicle.nationalSubsidy < 500) {
                    subsidyClass = 'subsidy-medium';
                }
                
                vehicleItem.innerHTML = `
                    <div class="vehicle-name">${vehicle.manufacturer} ${vehicle.model}</div>
                    <div class="vehicle-subsidy ${subsidyClass}">국고 보조금: ${vehicle.nationalSubsidy}만원</div>
                `;
                
                vehicleList.appendChild(vehicleItem);
            });
            
            updateVehicleCount(filteredVehicles.length);
        }

        // 차량 개수 업데이트
        function updateVehicleCount(count) {
            const countElement = document.getElementById('vehicleCount');
            if (countElement) {
                countElement.textContent = `총 ${count}개 차량`;
            }
        }

        // 차량 선택
        function selectVehicleFromList(vehicle, element) {
            // 이전 선택 해제
            document.querySelectorAll('.vehicle-item, .no-selection-item').forEach(item => item.classList.remove('selected'));
            
            // 현재 선택 표시
            element.classList.add('selected');
            
            // 차량 정보 저장
            selectedVehicle = vehicle;
            
            // 지자체 보조금 처리 (지역별 보조금 탭인 경우에만)
            if (currentLocalSubsidyTab === 'region') {
                const localSubsidySelect = document.getElementById('localSubsidy');
                
                if (vehicle) {
                    // 지역별 보조금 업데이트
                    updateLocalSubsidyForVehicle(vehicle);
                } else {
                    // 차량이 선택되지 않은 경우 전체 지역 목록 표시
                    updateLocalSubsidyOptions();
                }
                localSubsidySelect.value = 0;
            }
            
            // 선택된 차량 정보 표시
            if (vehicle) {
                showSelectedVehicleInfo(`${vehicle.manufacturer} ${vehicle.model}`, vehicle.nationalSubsidy);
                // 빠른 계산기 동기화
                document.getElementById('quickSubsidy').value = vehicle.nationalSubsidy;
            } else {
                showSelectedVehicleInfo('차량 선택 안함', 0);
                document.getElementById('quickSubsidy').value = 0;
            }
            
            syncQuickCalc();
        }

        // 지역별 보조금 옵션 업데이트 (차량이 선택되지 않은 경우)
        function updateLocalSubsidyOptions() {
            const select = document.getElementById('localSubsidy');
            
            // 기존 옵션 제거
            select.innerHTML = '<option value="0">지역을 선택하세요</option>';
            
            // 모든 지역 추가
            regionData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.subsidy;
                option.textContent = `${item.region} (${item.subsidy}만원)`;
                select.appendChild(option);
            });
        }

        // 선택된 차량의 지역별 보조금 업데이트
        function updateLocalSubsidyForVehicle(vehicle) {
            const select = document.getElementById('localSubsidy');
            
            // 기존 옵션 제거
            select.innerHTML = '<option value="0">지역을 선택하세요</option>';
            
            // 차량별 지역 보조금이 있는 경우 우선 표시
            if (vehicle && vehicle.regions && vehicle.regions.size > 0) {
                vehicle.regions.forEach((subsidy, region) => {
                    const option = document.createElement('option');
                    option.value = subsidy;
                    option.textContent = `${region} (${subsidy}만원) - 해당 차량`;
                    option.style.fontWeight = 'bold';
                    option.style.color = '#059669';
                    select.appendChild(option);
                });
                
                // 구분선 추가
                const divider = document.createElement('option');
                divider.disabled = true;
                divider.textContent = '── 기타 지역 ──';
                select.appendChild(divider);
            }
            
            // 나머지 지역들 추가
            regionData.forEach(item => {
                // 이미 차량별 데이터가 있는 지역은 제외
                if (vehicle && vehicle.regions && vehicle.regions.has(item.region)) {
                    return;
                }
                
                const option = document.createElement('option');
                option.value = item.subsidy;
                option.textContent = `${item.region} (${item.subsidy}만원)`;
                select.appendChild(option);
            });
        }

        // 지자체 보조금 선택 옵션 생성 (함수 제거됨)

        // 지자체 보조금 탭 전환
        function switchLocalSubsidyTab(tab) {
            currentLocalSubsidyTab = tab;
            
            // 탭 버튼 활성화 상태 변경
            const localSubsidyTabs = document.querySelectorAll('.form-group:last-of-type .vehicle-tab');
            localSubsidyTabs.forEach(t => t.classList.remove('active'));
            localSubsidyTabs[tab === 'region' ? 0 : 1].classList.add('active');
            
            // 탭 패널 표시/숨김
            document.getElementById('region-tab').classList.toggle('active', tab === 'region');
            document.getElementById('manual-tab').classList.toggle('active', tab === 'manual');
            
            // 빠른 계산기 동기화
            syncQuickCalc();
        }

        // 차량 탭 전환
        function switchVehicleTab(tab) {
            currentTab = tab;
            
            // 차량 선택 탭의 탭 버튼만 활성화 상태 변경
            const vehicleTabButtons = document.querySelectorAll('.vehicle-selection .vehicle-tab');
            vehicleTabButtons.forEach((t, index) => {
                if (index === 0 && tab === 'list') t.classList.add('active');
                else if (index === 1 && tab === 'direct') t.classList.add('active');
                else t.classList.remove('active');
            });
            
            // 차량 선택 탭의 패널만 변경
            document.getElementById('list-tab').classList.toggle('active', tab === 'list');
            document.getElementById('direct-tab').classList.toggle('active', tab === 'direct');
            
            // 직접 입력 탭으로 전환 시 차량 선택 초기화
            if (tab === 'direct') {
                // 모든 선택 해제
                document.querySelectorAll('.vehicle-item, .no-selection-item').forEach(item => item.classList.remove('selected'));
                selectedVehicle = null;
                
                // 선택된 차량 정보 숨김
                document.getElementById('selectedVehicleInfo').style.display = 'none';
                
                // 지자체 보조금이 지역별 탭인 경우 초기화
                if (currentLocalSubsidyTab === 'region') {
                    const localSubsidySelect = document.getElementById('localSubsidy');
                    // 차량이 선택되지 않은 경우 전체 지역 목록 표시
                    updateLocalSubsidyOptions();
                    localSubsidySelect.value = 0;
                }
                
                // 빠른 계산기 초기화
                document.getElementById('quickSubsidy').value = 0;
                if (currentLocalSubsidyTab === 'region') {
                    document.getElementById('quickLocal').value = 0;
                }
            }
        }

        // 선택된 차량 정보 표시
        function showSelectedVehicleInfo(name, subsidy) {
            document.getElementById('selectedVehicleName').textContent = name;
            document.getElementById('selectedVehicleSubsidy').textContent = subsidy;
            document.getElementById('selectedVehicleInfo').style.display = 'block';
        }

        // 가격 조작 함수들
        function addPrice(amount) {
            const priceInput = document.getElementById('vehiclePrice');
            const currentValue = parseInt(priceInput.value) || 0;
            priceInput.value = currentValue + amount;
            syncQuickCalc();
        }

        function clearPrice() {
            document.getElementById('vehiclePrice').value = '';
            document.getElementById('quickPrice').value = '';
        }

        // 좌측과 우측 동기화
        function syncQuickCalc() {
            const vehiclePrice = document.getElementById('vehiclePrice').value;
            
            if (vehiclePrice) {
                document.getElementById('quickPrice').value = vehiclePrice;
            }

            // 지자체 보조금 동기화
            let localSubsidyValue = 0;
            if (currentLocalSubsidyTab === 'region') {
                localSubsidyValue = document.getElementById('localSubsidy').value;
            } else {
                localSubsidyValue = document.getElementById('customLocalSubsidy').value;
            }
            
            if (localSubsidyValue) {
                document.getElementById('quickLocal').value = localSubsidyValue;
            }

            // 선택된 차량이 있으면 보조금도 동기화
            if (selectedVehicle && selectedVehicle.nationalSubsidy) {
                document.getElementById('quickSubsidy').value = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                const customSubsidy = document.getElementById('customSubsidy').value;
                if (customSubsidy) {
                    document.getElementById('quickSubsidy').value = customSubsidy;
                }
            }
        }

        // 빠른 계산 기능
        function quickCalculate() {
            const quickPrice = parseInt(document.getElementById('quickPrice').value) || 0;
            const quickSubsidy = parseInt(document.getElementById('quickSubsidy').value) || 0;
            const quickLocal = parseInt(document.getElementById('quickLocal').value) || 0;

            if (!quickPrice) return;

            // 보조금 지원 기준 적용
            let subsidyRate = 1;
            if (quickPrice >= 8500) {
                subsidyRate = 0;
            } else if (quickPrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(quickSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(quickLocal * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // 차량 종류에 따른 세율 적용
            const vehicleType = document.getElementById('vehicleType').value;
            const taxRates = {
                'passenger': 0.07,
                'compact': 0.04,  // 경차
                'van': 0.05,
                'truck': 0.05,
                'commercial': 0.04
            };
            const taxRate = taxRates[vehicleType] || 0.07;
            
            // 기본 취득세 계산
            const baseTax = Math.floor(quickPrice * taxRate);
            
            // 감면 계산
            let taxReduction;
            if (vehicleType === 'compact') {
                // 경차: 4% 적용 후 75만원 감면
                taxReduction = 75;
            } else {
                // 일반 전기차: 최대 140만원 감면
                taxReduction = Math.min(140, baseTax);
            }
            const finalTax = Math.max(0, baseTax - taxReduction);

            // 총 지불 금액
            const totalPayment = Math.max(0, quickPrice + finalTax - totalSubsidy);

            // 결과 표시
            document.getElementById('quickNationalSubsidy').textContent = `${finalNationalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickLocalSubsidy').textContent = `${finalLocalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickTotalSubsidy').textContent = `${totalSubsidy.toLocaleString()}만원`;
            document.getElementById('quickTax').textContent = `${finalTax.toLocaleString()}만원`;
            document.getElementById('quickFinalAmount').textContent = `${totalPayment.toLocaleString()}만원`;

            document.getElementById('quickResults').style.display = 'block';
        }

        // 메인 계산 기능
        function calculateTax() {
            const vehiclePrice = parseInt(document.getElementById('vehiclePrice').value) || 0;
            const vehicleType = document.getElementById('vehicleType').value;
            
            // 지자체 보조금 가져오기
            let localSubsidyAmount = 0;
            if (currentLocalSubsidyTab === 'region') {
                localSubsidyAmount = parseInt(document.getElementById('localSubsidy').value) || 0;
            } else {
                localSubsidyAmount = parseInt(document.getElementById('customLocalSubsidy').value) || 0;
            }

            if (!vehiclePrice) {
                alert('차량 가액을 입력해주세요.');
                return;
            }

            // 국고 보조금 결정
            let nationalSubsidy = 0;
            if (currentTab === 'list' && selectedVehicle) {
                nationalSubsidy = selectedVehicle.nationalSubsidy;
            } else if (currentTab === 'direct') {
                nationalSubsidy = parseInt(document.getElementById('customSubsidy').value) || 0;
            }

            // 세율 설정
            const taxRates = {
                'passenger': 0.07,
                'compact': 0.04,  // 경차
                'van': 0.05,
                'truck': 0.05,
                'commercial': 0.04
            };

            // 보조금 지원 기준 적용
            let subsidyRate = 1;
            if (vehiclePrice >= 8500) {
                subsidyRate = 0;
            } else if (vehiclePrice >= 5300) {
                subsidyRate = 0.5;
            }

            const finalNationalSubsidy = Math.floor(nationalSubsidy * subsidyRate);
            const finalLocalSubsidy = Math.floor(localSubsidyAmount * subsidyRate);
            const totalSubsidy = finalNationalSubsidy + finalLocalSubsidy;

            // 기본 취득세 계산
            const taxRate = taxRates[vehicleType];
            const baseTax = Math.floor(vehiclePrice * taxRate);

            // 감면 계산
            let taxReduction;
            if (vehicleType === 'compact') {
                // 경차: 4% 적용 후 75만원 감면
                taxReduction = 75;
            } else {
                // 일반 전기차: 최대 140만원 감면
                taxReduction = Math.min(140, baseTax);
            }
            const finalTax = Math.max(0, baseTax - taxReduction);

            // 총 지불 금액
            const totalPayment = Math.max(0, vehiclePrice + finalTax - totalSubsidy);

            // 결과 표시
            displayResults({
                nationalSubsidy: finalNationalSubsidy,
                localSubsidy: finalLocalSubsidy,
                totalSubsidy: totalSubsidy,
                baseTax: baseTax,
                taxReduction: taxReduction,
                finalTax: finalTax,
                totalPayment: totalPayment,
                vehiclePrice: vehiclePrice
            });

            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 빠른 계산도 자동으로 실행
            quickCalculate();
        }

        // 결과 표시
        function displayResults(results) {
            // 기본 결과 표시
            document.getElementById('nationalSubsidy').innerHTML = `<span class="result-icon">💰</span>${results.nationalSubsidy.toLocaleString()}만원`;
            document.getElementById('localSubsidyAmount').innerHTML = `<span class="result-icon">🏛️</span>${results.localSubsidy.toLocaleString()}만원`;
            document.getElementById('totalSubsidy').innerHTML = `<span class="result-icon">💎</span>${results.totalSubsidy.toLocaleString()}만원`;
            document.getElementById('baseTax').innerHTML = `<span class="result-icon">📋</span>${results.baseTax.toLocaleString()}만원`;
            document.getElementById('taxReduction').innerHTML = `<span class="result-icon">🎁</span>${results.taxReduction.toLocaleString()}만원`;
            document.getElementById('finalTaxInGrid').innerHTML = `<span class="result-icon">💸</span>${results.finalTax.toLocaleString()}만원`;
            
            // 계산 요약 표시
            document.getElementById('vehiclePriceDisplay').textContent = `${results.vehiclePrice.toLocaleString()}만원`;
            document.getElementById('finalTaxDisplay').textContent = `${results.finalTax.toLocaleString()}만원`;
            document.getElementById('totalSubsidyDisplay').textContent = `${results.totalSubsidy.toLocaleString()}만원`;
            document.getElementById('totalPaymentBreakdown').textContent = `${results.totalPayment.toLocaleString()}만원`;
            
            // 최종 결과 표시
            document.getElementById('totalPayment').innerHTML = `<span>🏦</span>${results.totalPayment.toLocaleString()}만원`;
        }
    </script>
</body>
</html>